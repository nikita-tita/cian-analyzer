<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RealEstate Analytics Pro</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Spotify-inspired colors */
            --spotify-green: #1DB954;
            --spotify-dark: #121212;
            --spotify-darker: #000000;
            --spotify-light: #181818;
            --spotify-lighter: #282828;
            --text-primary: #FFFFFF;
            --text-secondary: #B3B3B3;
            --text-muted: #535353;
            --error: #FF4444;
            --warning: #FFA500;
            --success: #1DB954;
            --info: #1ED760;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--spotify-dark);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Sidebar Navigation */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 240px;
            height: 100vh;
            background: var(--spotify-darker);
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 1000;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--spotify-green), #1ED760);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--spotify-green), #1ED760);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-item {
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-secondary);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-item:hover {
            background: var(--spotify-lighter);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: var(--spotify-lighter);
            color: var(--text-primary);
        }

        .nav-icon {
            font-size: 20px;
        }

        /* Main Content */
        .main-content {
            margin-left: 240px;
            padding: 24px;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(180deg, var(--spotify-light) 0%, transparent 100%);
            padding: 32px 0;
            margin-bottom: 32px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 48px;
            font-weight: 800;
            background: linear-gradient(135deg, #FFFFFF, var(--spotify-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border-radius: 500px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            text-transform: none;
            letter-spacing: 0;
        }

        .btn-primary {
            background: var(--spotify-green);
            color: var(--spotify-darker);
        }

        .btn-primary:hover {
            background: #1ED760;
            transform: scale(1.04);
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--text-secondary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            border-color: var(--text-primary);
            transform: scale(1.04);
        }

        /* Cards */
        .card {
            background: var(--spotify-light);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid transparent;
        }

        .card:hover {
            background: var(--spotify-lighter);
            border-color: var(--spotify-green);
            transform: translateY(-4px);
        }

        .card-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .card-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--spotify-light);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--spotify-green);
            transition: width 0.3s ease;
        }

        .stat-card:hover::before {
            width: 100%;
            opacity: 0.1;
        }

        .stat-card:hover {
            transform: translateX(4px);
        }

        .stat-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .stat-change {
            font-size: 14px;
            font-weight: 600;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--error);
        }

        /* Scenario Cards */
        .scenarios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }

        .scenario-card {
            background: linear-gradient(135deg, var(--spotify-light), var(--spotify-lighter));
            border-radius: 16px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .scenario-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--spotify-green), #1ED760);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .scenario-card:hover::before {
            opacity: 0.1;
        }

        .scenario-card:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: var(--spotify-green);
            box-shadow: 0 20px 40px rgba(29, 185, 84, 0.3);
        }

        .scenario-card.selected {
            border-color: var(--spotify-green);
            box-shadow: 0 0 30px rgba(29, 185, 84, 0.4);
        }

        .scenario-content {
            position: relative;
            z-index: 1;
        }

        .scenario-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 500px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .scenario-badge.fast {
            background: rgba(29, 185, 84, 0.2);
            color: var(--spotify-green);
        }

        .scenario-badge.optimal {
            background: rgba(30, 215, 96, 0.2);
            color: #1ED760;
        }

        .scenario-badge.standard {
            background: rgba(255, 165, 0, 0.2);
            color: var(--warning);
        }

        .scenario-badge.maximum {
            background: rgba(255, 68, 68, 0.2);
            color: var(--error);
        }

        .scenario-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .scenario-desc {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .scenario-metrics {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .scenario-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .scenario-metric-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .scenario-metric-value {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .probability-bar {
            width: 100%;
            height: 4px;
            background: var(--spotify-lighter);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 12px;
        }

        .probability-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--spotify-green), #1ED760);
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Charts */
        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 24px;
        }

        /* Input Form */
        .input-section {
            background: var(--spotify-light);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input {
            background: var(--spotify-darker);
            border: 2px solid var(--spotify-lighter);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--spotify-green);
            background: var(--spotify-light);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 0;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--spotify-green);
        }

        /* Loading Animation */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--spotify-lighter);
            border-top-color: var(--spotify-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Results Section */
        .results-section {
            display: none;
            animation: fadeIn 0.6s ease;
        }

        .results-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Price Tag */
        .price-tag {
            display: inline-flex;
            align-items: baseline;
            gap: 4px;
        }

        .price-value {
            font-size: 32px;
            font-weight: 800;
        }

        .price-unit {
            font-size: 16px;
            color: var(--text-secondary);
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 500px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .badge-success {
            background: rgba(29, 185, 84, 0.2);
            color: var(--success);
        }

        .badge-danger {
            background: rgba(255, 68, 68, 0.2);
            color: var(--error);
        }

        .badge-warning {
            background: rgba(255, 165, 0, 0.2);
            color: var(--warning);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 72px;
                padding: 16px;
            }

            .logo-text,
            .nav-text {
                display: none;
            }

            .main-content {
                margin-left: 72px;
                padding: 16px;
            }

            .header-title {
                font-size: 32px;
            }

            .stats-grid,
            .scenarios-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Smooth Scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Selection */
        ::selection {
            background: var(--spotify-green);
            color: var(--spotify-darker);
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">
            <div class="logo-icon">üè†</div>
            <div class="logo-text">RealEstate</div>
        </div>

        <nav>
            <div class="nav-item active" data-section="dashboard">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">–î–∞—à–±–æ—Ä–¥</span>
            </div>
            <div class="nav-item" data-section="scenarios">
                <span class="nav-icon">üéØ</span>
                <span class="nav-text">–°—Ü–µ–Ω–∞—Ä–∏–∏</span>
            </div>
            <div class="nav-item" data-section="analytics">
                <span class="nav-icon">üìà</span>
                <span class="nav-text">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
            </div>
            <div class="nav-item" data-section="comparables">
                <span class="nav-icon">üîç</span>
                <span class="nav-text">–ê–Ω–∞–ª–æ–≥–∏</span>
            </div>
        </nav>

        <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid var(--spotify-lighter);">
            <div class="nav-item">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-text">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div>
                    <h1 class="header-title">Analytics</h1>
                    <p style="color: var(--text-secondary); margin-top: 8px;">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="resetForm()">–°–±—Ä–æ—Å–∏—Ç—å</button>
                    <button class="btn btn-primary" onclick="runAnalysis()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑</button>
                </div>
            </div>
        </header>

        <!-- Cian Parser Section -->
        <section class="card" style="margin-bottom: 24px;">
            <h2 class="card-title">üîó –ò–º–ø–æ—Ä—Ç –∏–∑ Cian</h2>
            <p class="card-subtitle">–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è</p>

            <div style="display: flex; gap: 12px; align-items: stretch;">
                <input
                    type="text"
                    id="cian-url"
                    class="form-input"
                    placeholder="https://spb.cian.ru/sale/flat/123456/"
                    style="flex: 1;"
                >
                <button class="btn btn-primary" onclick="parseCianUrl()" style="white-space: nowrap;">
                    üîç –°–ø–∞—Ä—Å–∏—Ç—å
                </button>
            </div>

            <div id="parse-status" style="margin-top: 12px; font-size: 14px; display: none;"></div>
        </section>

        <!-- Input Section -->
        <section class="input-section">
            <h2 class="card-title">–î–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç–∞</h2>
            <p class="card-subtitle">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä—Å–µ—Ä –≤—ã—à–µ)</p>

            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">–¶–µ–Ω–∞ (‚ÇΩ)</label>
                    <input type="number" id="price" class="form-input" placeholder="195000000">
                </div>

                <div class="form-group">
                    <label class="form-label">–ü–ª–æ—â–∞–¥—å –æ–±—â–∞—è (–º¬≤)</label>
                    <input type="number" id="total_area" class="form-input" placeholder="180.4">
                </div>

                <div class="form-group">
                    <label class="form-label">–ü–ª–æ—â–∞–¥—å –∂–∏–ª–∞—è (–º¬≤)</label>
                    <input type="number" id="living_area" class="form-input" placeholder="40">
                </div>

                <div class="form-group">
                    <label class="form-label">–ö–æ–º–Ω–∞—Ç</label>
                    <input type="number" id="rooms" class="form-input" placeholder="3">
                </div>

                <div class="form-group">
                    <label class="form-label">–≠—Ç–∞–∂</label>
                    <input type="number" id="current_floor" class="form-input" placeholder="15">
                </div>

                <div class="form-group">
                    <label class="form-label">–≠—Ç–∞–∂–µ–π –≤ –¥–æ–º–µ</label>
                    <input type="number" id="total_floors" class="form-input" placeholder="25">
                </div>

                <div class="form-group">
                    <label class="form-label">–ú–µ—Ç—Ä–æ (–º–∏–Ω)</label>
                    <input type="number" id="metro_distance_min" class="form-input" placeholder="7">
                </div>

                <div class="form-group">
                    <label class="form-label">–¢–∏–ø –¥–æ–º–∞</label>
                    <select id="house_type" class="form-input">
                        <option value="–º–æ–Ω–æ–ª–∏—Ç">–ú–æ–Ω–æ–ª–∏—Ç</option>
                        <option value="–∫–∏—Ä–ø–∏—á">–ö–∏—Ä–ø–∏—á</option>
                        <option value="–ø–∞–Ω–µ–ª—å">–ü–∞–Ω–µ–ª—å</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–∫–æ–≤–∫–∞</label>
                    <select id="parking" class="form-input">
                        <option value="–ø–æ–¥–∑–µ–º–Ω–∞—è">–ü–æ–¥–∑–µ–º–Ω–∞—è</option>
                        <option value="–∑–∞–∫—Ä—ã—Ç–∞—è">–ó–∞–∫—Ä—ã—Ç–∞—è</option>
                        <option value="–Ω–µ—Ç">–ù–µ—Ç</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">–ü–æ—Ç–æ–ª–∫–∏ (–º)</label>
                    <input type="number" step="0.1" id="ceiling_height" class="form-input" placeholder="3.0">
                </div>

                <div class="form-group">
                    <label class="form-label">–ì–æ–¥ –ø–æ—Å—Ç—Ä–æ–π–∫–∏</label>
                    <input type="number" id="build_year" class="form-input" placeholder="2020">
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-top: 24px;">
                <label class="checkbox-group">
                    <input type="checkbox" id="has_design" class="checkbox" checked>
                    <span>–î–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏–π —Ä–µ–º–æ–Ω—Ç</span>
                </label>

                <label class="checkbox-group">
                    <input type="checkbox" id="panoramic_views" class="checkbox" checked>
                    <span>–ü–∞–Ω–æ—Ä–∞–º–Ω—ã–µ –≤–∏–¥—ã</span>
                </label>

                <label class="checkbox-group">
                    <input type="checkbox" id="premium_location" class="checkbox" checked>
                    <span>–ü—Ä–µ–º–∏—É–º –ª–æ–∫–∞—Ü–∏—è</span>
                </label>

                <label class="checkbox-group">
                    <input type="checkbox" id="security_247" class="checkbox" checked>
                    <span>–û—Ö—Ä–∞–Ω–∞ 24/7</span>
                </label>

                <label class="checkbox-group">
                    <input type="checkbox" id="has_elevator" class="checkbox" checked>
                    <span>–õ–∏—Ñ—Ç</span>
                </label>

                <label class="checkbox-group">
                    <input type="checkbox" id="renders_only" class="checkbox">
                    <span>–¢–æ–ª—å–∫–æ —Ä–µ–Ω–¥–µ—Ä—ã</span>
                </label>
            </div>
        </section>

        <!-- Comparables Section -->
        <section class="card" id="comparablesSection" style="display: none;">
            <h2 class="card-title">üìä –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∞–Ω–∞–ª–æ–≥–∏</h2>
            <p class="card-subtitle">–° —ç—Ç–∏–º–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏ –±—É–¥–µ—Ç –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ</p>

            <div id="comparablesList" style="margin-top: 20px;">
                <!-- Will be populated by JS -->
            </div>

            <div style="margin-top: 16px; padding: 12px; background: rgba(29, 185, 84, 0.1); border-radius: 8px;">
                <span style="color: #1DB954; font-weight: 500;">
                    ‚úÖ –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∞–Ω–∞–ª–∏–∑
                </span>
            </div>
        </section>

        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p class="loading-text">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ...</p>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="results">
            <!-- Stats Overview -->
            <div class="stats-grid" id="statsGrid">
                <!-- Will be populated by JS -->
            </div>

            <!-- Price Analysis -->
            <div class="card">
                <h2 class="card-title">–ê–Ω–∞–ª–∏–∑ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–π —Ü–µ–Ω—ã</h2>
                <p class="card-subtitle">–†—ã–Ω–æ—á–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–æ–≥–æ–≤ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫</p>
                <div class="chart-container">
                    <canvas id="priceChart"></canvas>
                </div>
            </div>

            <!-- Scenarios -->
            <div class="card">
                <h2 class="card-title">–°—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ–¥–∞–∂–∏</h2>
                <p class="card-subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</p>
                <div class="scenarios-grid" id="scenariosGrid">
                    <!-- Will be populated by JS -->
                </div>
            </div>

            <!-- Trajectory Chart -->
            <div class="card">
                <h2 class="card-title">–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è —Ü–µ–Ω—ã</h2>
                <p class="card-subtitle">–î–∏–Ω–∞–º–∏–∫–∞ —Å–Ω–∏–∂–µ–Ω–∏—è —Ü–µ–Ω—ã –ø–æ –º–µ—Å—è—Ü–∞–º</p>
                <div class="chart-container">
                    <canvas id="trajectoryChart"></canvas>
                </div>
            </div>

            <!-- Probability Chart -->
            <div class="card">
                <h2 class="card-title">–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–∞–∂–∏</h2>
                <p class="card-subtitle">–ö—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ –º–µ—Å—è—Ü–∞–º</p>
                <div class="chart-container">
                    <canvas id="probabilityChart"></canvas>
                </div>
            </div>

            <!-- Comparables -->
            <div class="card">
                <h2 class="card-title">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∞–Ω–∞–ª–æ–≥–∞–º–∏</h2>
                <p class="card-subtitle">–¶–µ–Ω–∞ –∑–∞ –º¬≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä—ã–Ω–∫–∞</p>
                <div class="chart-container">
                    <canvas id="comparablesChart"></canvas>
                </div>
            </div>

            <!-- Strengths & Weaknesses -->
            <div class="card">
                <h2 class="card-title">–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑</h2>
                <p class="card-subtitle">–°–∏–ª—å–Ω—ã–µ –∏ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –æ–±—ä–µ–∫—Ç–∞</p>
                <div id="strengthsWeaknessesContainer" style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <!-- Will be populated by JS -->
                </div>
            </div>
        </div>
    </main>

    <script>
        // Global state
        let analysisData = null;
        let charts = {};

        // Format number as currency
        function formatCurrency(value) {
            return new Intl.NumberFormat('ru-RU', {
                style: 'currency',
                currency: 'RUB',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        }

        // Format number as millions
        function formatMillions(value) {
            return (value / 1_000_000).toFixed(1) + ' –º–ª–Ω ‚ÇΩ';
        }

        // Format percentage
        function formatPercent(value) {
            return (value >= 0 ? '+' : '') + value.toFixed(1) + '%';
        }

        // Get form data
        function getFormData() {
            return {
                price: parseFloat(document.getElementById('price').value),
                total_area: parseFloat(document.getElementById('total_area').value),
                living_area: parseFloat(document.getElementById('living_area').value),
                rooms: parseInt(document.getElementById('rooms').value),
                current_floor: parseInt(document.getElementById('current_floor').value),
                total_floors: parseInt(document.getElementById('total_floors').value),
                metro_distance_min: parseInt(document.getElementById('metro_distance_min').value),
                house_type: document.getElementById('house_type').value,
                parking: document.getElementById('parking').value,
                ceiling_height: parseFloat(document.getElementById('ceiling_height').value),
                build_year: parseInt(document.getElementById('build_year').value),
                has_design: document.getElementById('has_design').checked,
                panoramic_views: document.getElementById('panoramic_views').checked,
                premium_location: document.getElementById('premium_location').checked,
                security_247: document.getElementById('security_247').checked,
                has_elevator: document.getElementById('has_elevator').checked,
                renders_only: document.getElementById('renders_only').checked
            };
        }

        // Parse Cian URL
        async function parseCianUrl() {
            const url = document.getElementById('cian-url').value.trim();
            const statusEl = document.getElementById('parse-status');

            if (!url) {
                statusEl.style.display = 'block';
                statusEl.style.color = 'var(--error)';
                statusEl.textContent = '‚ùå –í–≤–µ–¥–∏—Ç–µ URL –æ–±—ä—è–≤–ª–µ–Ω–∏—è';
                return;
            }

            // Show loading
            statusEl.style.display = 'block';
            statusEl.style.color = 'var(--text-secondary)';
            statusEl.textContent = '‚è≥ –ü–∞—Ä—Å–∏–º –æ–±—ä—è–≤–ª–µ–Ω–∏–µ...';

            try {
                const response = await fetch('/api/parse-cian', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ url: url })
                });

                const data = await response.json();

                if (data.success) {
                    // Fill form with parsed data
                    const prop = data.target_property;

                    // –°—á–∏—Ç–∞–µ–º —Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–π –∑–∞–ø–æ–ª–Ω–∏–ª–∏
                    let filledCount = 0;
                    let totalFields = 0;

                    const fillField = (id, value) => {
                        totalFields++;
                        if (value !== null && value !== undefined) {
                            document.getElementById(id).value = value;
                            filledCount++;
                            return true;
                        }
                        return false;
                    };

                    fillField('price', prop.price);
                    fillField('total_area', prop.total_area);
                    fillField('living_area', prop.living_area);
                    fillField('rooms', prop.rooms);
                    fillField('current_floor', prop.current_floor);
                    fillField('total_floors', prop.total_floors);
                    fillField('metro_distance_min', prop.metro_distance_min);
                    fillField('house_type', prop.house_type);
                    fillField('parking', prop.parking);
                    fillField('ceiling_height', prop.ceiling_height);
                    fillField('build_year', prop.build_year);

                    if (prop.has_design !== undefined) document.getElementById('has_design').checked = prop.has_design;
                    if (prop.panoramic_views !== undefined) document.getElementById('panoramic_views').checked = prop.panoramic_views;
                    if (prop.premium_location !== undefined) document.getElementById('premium_location').checked = prop.premium_location;
                    if (prop.security_247 !== undefined) document.getElementById('security_247').checked = prop.security_247;
                    if (prop.has_elevator !== undefined) document.getElementById('has_elevator').checked = prop.has_elevator;
                    if (prop.renders_only !== undefined) document.getElementById('renders_only').checked = prop.renders_only;

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
                    statusEl.innerHTML = `
                        <div style="padding: 12px; background: rgba(29, 185, 84, 0.1); border-radius: 8px; border: 1px solid rgba(29, 185, 84, 0.3);">
                            <div style="color: #1DB954; font-weight: 600; margin-bottom: 8px;">
                                ‚úÖ –û–±—ä—è–≤–ª–µ–Ω–∏–µ —Å–ø–∞—Ä—Å–µ–Ω–æ: ${prop.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}
                            </div>
                            <div style="font-size: 13px; color: rgba(255, 255, 255, 0.7);">
                                –ó–∞–ø–æ–ª–Ω–µ–Ω–æ ${filledCount} –∏–∑ ${totalFields} –ø–æ–ª–µ–π
                                ${filledCount < 5 ? '<br/>‚ö†Ô∏è Cian –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é' : ''}
                            </div>
                        </div>
                    `;

                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—â–µ–º –ø–æ—Ö–æ–∂–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    if (prop.price && prop.total_area && prop.rooms) {
                        statusEl.innerHTML += '<div style="margin-top: 8px; color: var(--text-secondary);">‚è≥ –ò—â–µ–º –ø–æ—Ö–æ–∂–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è...</div>';
                        await searchComparables(prop);
                    } else {
                        statusEl.innerHTML += '<div style="margin-top: 8px; padding: 8px; background: rgba(255, 193, 7, 0.1); border-radius: 6px; color: #FFC107; font-size: 13px;">‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–≤—Ç–æ–ø–æ–∏—Å–∫–∞ –∞–Ω–∞–ª–æ–≥–æ–≤. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –≤—Ä—É—á–Ω—É—é.</div>';
                    }

                    // Scroll to form
                    document.querySelector('.input-section').scrollIntoView({ behavior: 'smooth' });
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞');
                }
            } catch (error) {
                console.error('Parse error:', error);
                statusEl.style.color = 'var(--error)';
                statusEl.textContent = `‚ùå ${error.message}`;
            }
        }

        // Search comparables automatically
        async function searchComparables(targetProperty) {
            try {
                const response = await fetch('/api/search-comparables', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        target_property: targetProperty,
                        limit: 10
                    })
                });

                const data = await response.json();

                if (data.success && data.comparables.length > 0) {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–Ω–∞–ª–æ–≥–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ
                    window.autoComparables = data.comparables;
                    console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${data.count} –∞–Ω–∞–ª–æ–≥–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏`);

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∞–Ω–∞–ª–æ–≥–æ–≤
                    displayComparables(data.comparables);
                }
            } catch (error) {
                console.error('Search comparables error:', error);
            }
        }

        // Display comparables list
        function displayComparables(comparables) {
            const section = document.getElementById('comparablesSection');
            const listEl = document.getElementById('comparablesList');

            if (comparables.length === 0) {
                section.style.display = 'none';
                return;
            }

            // Generate list HTML
            let html = '<div style="display: grid; gap: 16px;">';

            comparables.forEach((comp, index) => {
                const priceFormatted = comp.price ? (comp.price / 1_000_000).toFixed(1) + ' –º–ª–Ω ‚ÇΩ' : 'N/A';
                const areaFormatted = comp.total_area ? comp.total_area.toFixed(1) + ' –º¬≤' : 'N/A';
                const pricePerSqm = comp.price_per_sqm ? (comp.price_per_sqm / 1000).toFixed(0) + ' —Ç—ã—Å/–º¬≤' : 'N/A';

                html += `
                    <div style="
                        padding: 16px;
                        background: rgba(255, 255, 255, 0.03);
                        border: 1px solid rgba(255, 255, 255, 0.1);
                        border-radius: 8px;
                        display: grid;
                        grid-template-columns: 40px 1fr auto;
                        gap: 12px;
                        align-items: center;
                    ">
                        <div style="
                            width: 40px;
                            height: 40px;
                            background: rgba(29, 185, 84, 0.2);
                            border-radius: 8px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            color: #1DB954;
                            font-weight: 600;
                        ">${index + 1}</div>
                        <div>
                            <div style="font-weight: 500; margin-bottom: 4px;">
                                ${comp.title || '–û–±—ä—è–≤–ª–µ–Ω–∏–µ –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}
                            </div>
                            <div style="font-size: 13px; color: rgba(255, 255, 255, 0.6);">
                                ${areaFormatted} ‚Ä¢ ${comp.rooms || 'N/A'} –∫–æ–º–Ω. ‚Ä¢ ${comp.current_floor || '?'}/${comp.total_floors || '?'} —ç—Ç–∞–∂
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 600; color: #1DB954; margin-bottom: 4px;">
                                ${priceFormatted}
                            </div>
                            <div style="font-size: 13px; color: rgba(255, 255, 255, 0.6);">
                                ${pricePerSqm}
                            </div>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            html += `
                <div style="
                    margin-top: 16px;
                    padding: 12px;
                    background: rgba(29, 185, 84, 0.1);
                    border-radius: 8px;
                    text-align: center;
                    color: #1DB954;
                    font-weight: 500;
                ">
                    üìä –ù–∞–π–¥–µ–Ω–æ ${comparables.length} –∞–Ω–∞–ª–æ–≥–æ–≤ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                </div>
            `;

            listEl.innerHTML = html;
            section.style.display = 'block';

            // Scroll to comparables section
            setTimeout(() => {
                section.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 300);
        }

        // Run analysis
        async function runAnalysis() {
            const loadingEl = document.getElementById('loading');
            const resultsEl = document.getElementById('results');

            // Show loading
            loadingEl.classList.add('active');
            resultsEl.classList.remove('active');

            try {
                const targetProperty = getFormData();

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∞–Ω–∞–ª–æ–≥–æ–≤
                let comparables = window.autoComparables || [];

                if (comparables.length === 0) {
                    const useMockData = confirm(
                        '‚ö†Ô∏è –ê–Ω–∞–ª–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!\n\n' +
                        '–ü—Ä–∏—á–∏–Ω–∞: Cian –±–ª–æ–∫–∏—Ä—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥.\n\n' +
                        '–í–∞—Ä–∏–∞–Ω—Ç—ã:\n' +
                        '1. –ù–∞–∂–º–∏—Ç–µ "OK" - –∑–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑ —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–¥–ª—è –¥–µ–º–æ)\n' +
                        '2. –ù–∞–∂–º–∏—Ç–µ "–û—Ç–º–µ–Ω–∞" - –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é\n\n' +
                        '–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏?'
                    );

                    if (!useMockData) {
                        loadingEl.classList.remove('active');
                        return;
                    }

                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º mock-–¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
                    comparables = [
                        { price: 130_000_000, total_area: 171, has_design: true, price_per_sqm: 760234, title: '–¢–µ—Å—Ç–æ–≤—ã–π –∞–Ω–∞–ª–æ–≥ 1', rooms: 3 },
                        { price: 145_000_000, total_area: 185, has_design: true, price_per_sqm: 783783, title: '–¢–µ—Å—Ç–æ–≤—ã–π –∞–Ω–∞–ª–æ–≥ 2', rooms: 3 },
                        { price: 120_000_000, total_area: 163, has_design: true, price_per_sqm: 736196, title: '–¢–µ—Å—Ç–æ–≤—ã–π –∞–Ω–∞–ª–æ–≥ 3', rooms: 2 },
                        { price: 155_000_000, total_area: 195, has_design: true, price_per_sqm: 794871, title: '–¢–µ—Å—Ç–æ–≤—ã–π –∞–Ω–∞–ª–æ–≥ 4', rooms: 3 },
                        { price: 138_000_000, total_area: 178, has_design: true, price_per_sqm: 775280, title: '–¢–µ—Å—Ç–æ–≤—ã–π –∞–Ω–∞–ª–æ–≥ 5', rooms: 3 },
                        { price: 142_000_000, total_area: 182, has_design: true, price_per_sqm: 780219, title: '–¢–µ—Å—Ç–æ–≤—ã–π –∞–Ω–∞–ª–æ–≥ 6', rooms: 3 },
                        { price: 125_000_000, total_area: 168, has_design: false, price_per_sqm: 744047, title: '–¢–µ—Å—Ç–æ–≤—ã–π –∞–Ω–∞–ª–æ–≥ 7', rooms: 2 },
                        { price: 160_000_000, total_area: 198, has_design: true, price_per_sqm: 808080, title: '–¢–µ—Å—Ç–æ–≤—ã–π –∞–Ω–∞–ª–æ–≥ 8', rooms: 4 }
                    ];

                    console.log('‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º mock-–¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏');
                }

                console.log(`üìä –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑ —Å ${comparables.length} –∞–Ω–∞–ª–æ–≥–∞–º–∏`);

                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        target_property: targetProperty,
                        comparables: comparables
                    })
                });

                if (!response.ok) {
                    throw new Error('Analysis failed');
                }

                analysisData = await response.json();

                // Hide loading, show results
                setTimeout(() => {
                    loadingEl.classList.remove('active');
                    resultsEl.classList.add('active');
                    renderResults();
                }, 1000);

            } catch (error) {
                console.error('Analysis error:', error);
                alert('–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                loadingEl.classList.remove('active');
            }
        }

        // Render results
        function renderResults() {
            if (!analysisData) return;

            renderStatsGrid();
            renderScenarios();
            renderCharts();
            renderStrengthsWeaknesses();
        }

        // Render stats grid
        function renderStatsGrid() {
            const container = document.getElementById('statsGrid');
            const fairPrice = analysisData.fair_price_analysis;
            const target = analysisData.target_property;

            const stats = [
                {
                    label: '–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞',
                    value: formatMillions(target.price),
                    change: null
                },
                {
                    label: '–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–∞—è —Ü–µ–Ω–∞',
                    value: formatMillions(fairPrice.fair_price_total),
                    change: formatPercent(-fairPrice.overpricing_percent)
                },
                {
                    label: '–ü–µ—Ä–µ–æ—Ü–µ–Ω–∫–∞',
                    value: formatPercent(fairPrice.overpricing_percent),
                    change: fairPrice.overpricing_percent > 0 ? 'negative' : 'positive'
                },
                {
                    label: '–¶–µ–Ω–∞/–º¬≤',
                    value: formatMillions(target.price_per_sqm),
                    change: null
                }
            ];

            container.innerHTML = stats.map(stat => `
                <div class="stat-card">
                    <div class="stat-label">${stat.label}</div>
                    <div class="stat-value">${stat.value}</div>
                    ${stat.change ? `<div class="stat-change ${stat.change === 'positive' || parseFloat(stat.change) < 0 ? 'positive' : 'negative'}">${stat.change}</div>` : ''}
                </div>
            `).join('');
        }

        // Render scenarios
        function renderScenarios() {
            const container = document.getElementById('scenariosGrid');
            const scenarios = analysisData.price_scenarios;

            const badgeClasses = {
                '–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–¥–∞–∂–∞': 'fast',
                '–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–¥–∞–∂–∞': 'optimal',
                '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–æ–¥–∞–∂–∞': 'standard',
                '–ü–æ–ø—ã—Ç–∫–∞ –º–∞–∫—Å–∏–º—É–º–∞': 'maximum'
            };

            container.innerHTML = scenarios.map((scenario, index) => `
                <div class="scenario-card" onclick="selectScenario(${index})">
                    <div class="scenario-content">
                        <div class="scenario-badge ${badgeClasses[scenario.name]}">${scenario.type}</div>
                        <div class="scenario-title">${scenario.name}</div>
                        <div class="scenario-desc">${scenario.description}</div>

                        <div class="scenario-metrics">
                            <div class="scenario-metric">
                                <span class="scenario-metric-label">–°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ü–µ–Ω–∞</span>
                                <span class="scenario-metric-value">${formatMillions(scenario.start_price)}</span>
                            </div>
                            <div class="scenario-metric">
                                <span class="scenario-metric-label">–û–∂–∏–¥–∞–µ–º–∞—è —Ü–µ–Ω–∞</span>
                                <span class="scenario-metric-value">${formatMillions(scenario.expected_final_price)}</span>
                            </div>
                            <div class="scenario-metric">
                                <span class="scenario-metric-label">–°—Ä–æ–∫ –ø—Ä–æ–¥–∞–∂–∏</span>
                                <span class="scenario-metric-value">${scenario.time_months} –º–µ—Å</span>
                            </div>
                            <div class="scenario-metric">
                                <span class="scenario-metric-label">–ß–∏—Å—Ç—ã–π –¥–æ—Ö–æ–¥</span>
                                <span class="scenario-metric-value">${formatMillions(scenario.financials.net_after_opportunity)}</span>
                            </div>
                        </div>

                        <div class="probability-bar">
                            <div class="probability-fill" style="width: ${scenario.cumulative_probability[scenario.time_months] * 100}%"></div>
                        </div>
                        <div style="margin-top: 8px; font-size: 12px; color: var(--text-secondary);">
                            –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: ${(scenario.cumulative_probability[scenario.time_months] * 100).toFixed(0)}%
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Select scenario
        function selectScenario(index) {
            document.querySelectorAll('.scenario-card').forEach((card, i) => {
                if (i === index) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });

            updateTrajectoryChart(index);
            updateProbabilityChart(index);
        }

        // Render all charts
        function renderCharts() {
            renderPriceChart();
            renderTrajectoryChart(0);
            renderProbabilityChart(0);
            renderComparablesChart();
        }

        // Price chart
        function renderPriceChart() {
            const ctx = document.getElementById('priceChart');
            const fairPrice = analysisData.fair_price_analysis;

            if (charts.priceChart) {
                charts.priceChart.destroy();
            }

            charts.priceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞', '–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–∞—è —Ü–µ–Ω–∞', '–ú–∏–Ω–∏–º—É–º', '–ú–∞–∫—Å–∏–º—É–º'],
                    datasets: [{
                        label: '–¶–µ–Ω–∞ (–º–ª–Ω ‚ÇΩ)',
                        data: [
                            analysisData.target_property.price / 1_000_000,
                            fairPrice.fair_price_total / 1_000_000,
                            fairPrice.fair_price_total * 0.9 / 1_000_000,
                            fairPrice.fair_price_total * 1.1 / 1_000_000
                        ],
                        backgroundColor: [
                            'rgba(255, 68, 68, 0.8)',
                            'rgba(29, 185, 84, 0.8)',
                            'rgba(255, 165, 0, 0.8)',
                            'rgba(30, 215, 96, 0.8)'
                        ],
                        borderColor: [
                            '#FF4444',
                            '#1DB954',
                            '#FFA500',
                            '#1ED760'
                        ],
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#B3B3B3'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#B3B3B3'
                            }
                        }
                    }
                }
            });
        }

        // Trajectory chart
        function renderTrajectoryChart(scenarioIndex) {
            const ctx = document.getElementById('trajectoryChart');
            const scenario = analysisData.price_scenarios[scenarioIndex];

            if (charts.trajectoryChart) {
                charts.trajectoryChart.destroy();
            }

            charts.trajectoryChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: scenario.price_trajectory.map(p => `–ú–µ—Å—è—Ü ${p.month}`),
                    datasets: [{
                        label: '–¶–µ–Ω–∞ (–º–ª–Ω ‚ÇΩ)',
                        data: scenario.price_trajectory.map(p => p.price / 1_000_000),
                        borderColor: '#1DB954',
                        backgroundColor: 'rgba(29, 185, 84, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        pointBackgroundColor: '#1DB954',
                        pointBorderColor: '#FFFFFF',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#B3B3B3'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#B3B3B3'
                            }
                        }
                    }
                }
            });
        }

        // Probability chart
        function renderProbabilityChart(scenarioIndex) {
            const ctx = document.getElementById('probabilityChart');
            const scenario = analysisData.price_scenarios[scenarioIndex];

            if (charts.probabilityChart) {
                charts.probabilityChart.destroy();
            }

            charts.probabilityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: scenario.cumulative_probability.map((_, i) => `–ú–µ—Å—è—Ü ${i}`),
                    datasets: [{
                        label: '–ö—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å',
                        data: scenario.cumulative_probability.map(p => p * 100),
                        borderColor: '#1ED760',
                        backgroundColor: 'rgba(30, 215, 96, 0.2)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        pointBackgroundColor: '#1ED760',
                        pointBorderColor: '#FFFFFF',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            min: 0,
                            max: 100,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#B3B3B3',
                                callback: value => value + '%'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#B3B3B3'
                            }
                        }
                    }
                }
            });
        }

        // Update trajectory chart
        function updateTrajectoryChart(scenarioIndex) {
            renderTrajectoryChart(scenarioIndex);
        }

        // Update probability chart
        function updateProbabilityChart(scenarioIndex) {
            renderProbabilityChart(scenarioIndex);
        }

        // Comparables chart
        function renderComparablesChart() {
            const ctx = document.getElementById('comparablesChart');
            const chartData = analysisData.comparison_chart_data;

            if (charts.comparablesChart) {
                charts.comparablesChart.destroy();
            }

            charts.comparablesChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        label: '–¶–µ–Ω–∞ –∑–∞ –º¬≤ (–º–ª–Ω ‚ÇΩ)',
                        data: chartData.datasets[0].data,
                        backgroundColor: chartData.datasets[0].backgroundColor,
                        borderColor: chartData.datasets[0].borderColor,
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#B3B3B3'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#B3B3B3'
                            }
                        }
                    }
                }
            });
        }

        // Render strengths & weaknesses
        function renderStrengthsWeaknesses() {
            const container = document.getElementById('strengthsWeaknessesContainer');
            const data = analysisData.strengths_weaknesses;

            if (!data) {
                container.innerHTML = '<p style="color: var(--text-secondary); grid-column: 1 / -1;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</p>';
                return;
            }

            container.innerHTML = `
                <div>
                    <h3 style="color: var(--spotify-green); margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 24px;">‚úÖ</span> –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
                    </h3>
                    ${data.strengths.length > 0 ? `
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            ${data.strengths.map(s => `
                                <div style="
                                    background: rgba(29, 185, 84, 0.1);
                                    border: 1px solid rgba(29, 185, 84, 0.3);
                                    border-radius: 8px;
                                    padding: 12px;
                                ">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="color: var(--text-primary); font-weight: 500;">${s.factor}</span>
                                        <span style="
                                            background: var(--spotify-green);
                                            color: var(--spotify-darker);
                                            padding: 4px 12px;
                                            border-radius: 12px;
                                            font-size: 12px;
                                            font-weight: 600;
                                        ">+${s.premium_percent}%</span>
                                    </div>
                                    <div style="
                                        margin-top: 8px;
                                        height: 4px;
                                        background: rgba(29, 185, 84, 0.2);
                                        border-radius: 2px;
                                        overflow: hidden;
                                    ">
                                        <div style="
                                            height: 100%;
                                            width: ${(s.impact / 10) * 100}%;
                                            background: var(--spotify-green);
                                        "></div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="
                            margin-top: 16px;
                            padding: 12px;
                            background: rgba(29, 185, 84, 0.15);
                            border-radius: 8px;
                            text-align: center;
                        ">
                            <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 4px;">–°—É–º–º–∞—Ä–Ω–∞—è –ø—Ä–µ–º–∏—è</div>
                            <div style="font-size: 24px; font-weight: 700; color: var(--spotify-green);">+${data.total_premium_percent}%</div>
                        </div>
                    ` : `
                        <p style="color: var(--text-secondary); font-style: italic;">–ù–µ—Ç —Å–∏–ª—å–Ω—ã—Ö —Å—Ç–æ—Ä–æ–Ω</p>
                    `}
                </div>

                <div>
                    <h3 style="color: #FF6B6B; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 24px;">‚ö†Ô∏è</span> –°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
                    </h3>
                    ${data.weaknesses.length > 0 ? `
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            ${data.weaknesses.map(w => `
                                <div style="
                                    background: rgba(255, 107, 107, 0.1);
                                    border: 1px solid rgba(255, 107, 107, 0.3);
                                    border-radius: 8px;
                                    padding: 12px;
                                ">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="color: var(--text-primary); font-weight: 500;">${w.factor}</span>
                                        <span style="
                                            background: #FF6B6B;
                                            color: white;
                                            padding: 4px 12px;
                                            border-radius: 12px;
                                            font-size: 12px;
                                            font-weight: 600;
                                        ">-${w.discount_percent}%</span>
                                    </div>
                                    <div style="
                                        margin-top: 8px;
                                        height: 4px;
                                        background: rgba(255, 107, 107, 0.2);
                                        border-radius: 2px;
                                        overflow: hidden;
                                    ">
                                        <div style="
                                            height: 100%;
                                            width: ${(w.impact / 10) * 100}%;
                                            background: #FF6B6B;
                                        "></div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div style="
                            margin-top: 16px;
                            padding: 12px;
                            background: rgba(255, 107, 107, 0.15);
                            border-radius: 8px;
                            text-align: center;
                        ">
                            <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 4px;">–°—É–º–º–∞—Ä–Ω—ã–π –¥–∏—Å–∫–æ–Ω—Ç</div>
                            <div style="font-size: 24px; font-weight: 700; color: #FF6B6B;">-${data.total_discount_percent}%</div>
                        </div>
                    ` : `
                        <p style="color: var(--text-secondary); font-style: italic;">–ù–µ—Ç —Å–ª–∞–±—ã—Ö —Å—Ç–æ—Ä–æ–Ω</p>
                    `}
                </div>
            `;
        }

        // Reset form
        function resetForm() {
            location.reload();
        }

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Auto-run analysis on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                runAnalysis();
            }, 500);
        });
    </script>
</body>
</html>
