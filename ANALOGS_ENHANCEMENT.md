# –£–ª—É—á—à–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–Ω–∞–ª–æ–≥–æ–≤

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –∫–∞—Ä—Ç–æ—á–∫–∏ –∞–Ω–∞–ª–æ–≥–æ–≤ –¥–ª—è –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏.

## ‚ú® –ù–æ–≤—ã–µ –ø–æ–ª—è

### 1. üí∏ –¶–µ–Ω–∞ –∑–∞ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–π –º–µ—Ç—Ä (price_per_sqm)
- **–§–æ—Ä–º–∞—Ç**: –ß–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ä—É–±–ª—è—Ö
- **–†–∞—Å—á–µ—Ç**: `price_raw / area_value`
- **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ**: `823,874 ‚ÇΩ/–º¬≤`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ë—ã—Å—Ç—Ä–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ–±—ä–µ–∫—Ç–æ–≤ —Å —Ä–∞–∑–Ω–æ–π –ø–ª–æ—â–∞–¥—å—é

### 2. üö™ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç (rooms)
- **–§–æ—Ä–º–∞—Ç**: –°—Ç—Ä–æ–∫–∞ ('1', '2', '3', '4', '—Å—Ç—É–¥–∏—è')
- **–ò—Å—Ç–æ—á–Ω–∏–∫**: –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- **–ü—Ä–∏–º–µ—Ä**: `'4-–∫–æ–º–Ω. –∫–≤–∞—Ä—Ç–∏—Ä–∞'` ‚Üí `'4'`
- **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ**: `4 –∫–æ–º–Ω.`

### 3. üé® –¢–∏–ø —Ä–µ–º–æ–Ω—Ç–∞ (renovation)
- **–§–æ—Ä–º–∞—Ç**: –°—Ç—Ä–æ–∫–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Ä–µ–º–æ–Ω—Ç–∞
- **–ò—Å—Ç–æ—á–Ω–∏–∫**: –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- **–ü—Ä–∏–º–µ—Ä—ã**:
  - "–î–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏–π —Ä–µ–º–æ–Ω—Ç"
  - "–ö–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–º–æ–Ω—Ç"
  - "–ë–µ–∑ –æ—Ç–¥–µ–ª–∫–∏"
  - "–ï–≤—Ä–æ—Ä–µ–º–æ–Ω—Ç"
- **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ**: –ò–∫–æ–Ω–∫–∞ + —Ç–µ–∫—Å—Ç

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. Backend: `src/parsers/playwright_parser.py`

**–ú–µ—Ç–æ–¥**: `_parse_listing_card()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
```python
# –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ —Å–ª–æ–≤–∞—Ä—å data
data = {
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
    'price_per_sqm': None,      # –ù–û–í–û–ï
    'price_raw': None,           # –ù–û–í–û–ï
    'area_value': None,          # –ù–û–í–û–ï
    'rooms': None,               # –£–ª—É—á—à–µ–Ω–æ
    'renovation': None,          # –ù–û–í–û–ï
}

# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–º–Ω–∞—Ç –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞
if '—Å—Ç—É–¥–∏' in title_lower:
    data['rooms'] = '—Å—Ç—É–¥–∏—è'
else:
    match = re.search(r'(\d+)-–∫–æ–º–Ω', data['title'])
    if match:
        data['rooms'] = match.group(1)

# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–∏—Å–ª–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Ü–µ–Ω—ã
price_numbers = re.sub(r'[^\d]', '', price_text)
if price_numbers:
    data['price_raw'] = int(price_numbers)

# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–∏—Å–ª–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø–ª–æ—â–∞–¥–∏
area_match = re.search(r'([\d,\.]+)\s*–º¬≤', text)
if area_match:
    area_str = area_match.group(1).replace(',', '.')
    data['area_value'] = float(area_str)

# –ü–æ–∏—Å–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–º–æ–Ω—Ç–µ
elif '—Ä–µ–º–æ–Ω—Ç' in text.lower() or '–æ—Ç–¥–µ–ª–∫' in text.lower():
    data['renovation'] = text

# –†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã –∑–∞ –º¬≤
if data['price_raw'] and data['area_value']:
    data['price_per_sqm'] = round(data['price_raw'] / data['area_value'])
```

### 2. Frontend: `static/js/wizard.js`

**–ú–µ—Ç–æ–¥**: `renderComparableCard()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
```javascript
// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã –∑–∞ –º¬≤
let pricePerSqmText = '';
if (comp.price_per_sqm) {
    pricePerSqmText = `<div class="detail-item text-primary">
        <i class="bi bi-cash-stack"></i>
        ${utils.formatNumber(comp.price_per_sqm)} ‚ÇΩ/–º¬≤
    </div>`;
}

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–º–æ–Ω—Ç–∞
let renovationText = '';
if (comp.renovation) {
    renovationText = `<div class="detail-item">
        <i class="bi bi-paint-bucket"></i>
        ${comp.renovation}
    </div>`;
}

// –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª–µ–π
<div class="property-details">
    ${pricePerSqmText}              <!-- –ù–û–í–û–ï: –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–µ –ø–æ–ª–µ -->
    ${comp.rooms ? ... : ''}        <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç -->
    ${comp.area ? ... : ''}         <!-- –ü–ª–æ—â–∞–¥—å -->
    ${comp.floor ? ... : ''}        <!-- –≠—Ç–∞–∂ -->
    ${renovationText}               <!-- –ù–û–í–û–ï: —Ç–∏–ø —Ä–µ–º–æ–Ω—Ç–∞ -->
    ${comp.metro ? ... : ''}        <!-- –ú–µ—Ç—Ä–æ -->
</div>
```

## üéØ –ü—Ä–∏–º–µ—Ä –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

### –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```
–ö–≤–∞—Ä—Ç–∏—Ä–∞ —Å —Ç–µ—Ä—Ä–∞—Å–æ–π
48 000 000 ‚ÇΩ

üìè 123,8 –º¬≤
üè¢ 3/9 —ç—Ç–∞–∂
üöá –ö—Ä–µ—Å—Ç–æ–≤—Å–∫–∏–π –æ—Å—Ç—Ä–æ–≤

üìç –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, —Ä-–Ω –ü–µ—Ç—Ä–æ–≥—Ä–∞–¥—Å–∫–∏–π...
```

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```
4-–∫–æ–º–Ω. –∫–≤–∞—Ä—Ç–∏—Ä–∞, 123,8 –º¬≤, 3/9 —ç—Ç–∞–∂
102 000 000 ‚ÇΩ

üí∏ 823,874 ‚ÇΩ/–º¬≤         ‚Üê –ù–û–í–û–ï
üö™ 4 –∫–æ–º–Ω.              ‚Üê –ù–û–í–û–ï (—É–ª—É—á—à–µ–Ω–æ)
üìè 123,8 –º¬≤
üè¢ 3/9 —ç—Ç–∞–∂
üé® –î–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏–π —Ä–µ–º–æ–Ω—Ç  ‚Üê –ù–û–í–û–ï

üìç –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, —Ä-–Ω –ü–µ—Ç—Ä–æ–≥—Ä–∞–¥—Å–∫–∏–π...
üöá –ö—Ä–µ—Å—Ç–æ–≤—Å–∫–∏–π –æ—Å—Ç—Ä–æ–≤
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏–º–µ—Ä JSON –æ–±—ä–µ–∫—Ç–∞ –∞–Ω–∞–ª–æ–≥–∞:
```json
{
  "title": "4-–∫–æ–º–Ω. –∫–≤–∞—Ä—Ç–∏—Ä–∞, 123,8 –º¬≤, 3/9 —ç—Ç–∞–∂",
  "price": "102 000 000 ‚ÇΩ",
  "price_raw": 102000000,
  "price_per_sqm": 823874,
  "rooms": "4",
  "area": "123,8 –º¬≤",
  "area_value": 123.8,
  "floor": "3/9 —ç—Ç–∞–∂",
  "renovation": "–î–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏–π —Ä–µ–º–æ–Ω—Ç",
  "address": "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, —Ä-–Ω –ü–µ—Ç—Ä–æ–≥—Ä–∞–¥—Å–∫–∏–π...",
  "metro": "–ö—Ä–µ—Å—Ç–æ–≤—Å–∫–∏–π –æ—Å—Ç—Ä–æ–≤",
  "url": "https://www.cian.ru/sale/flat/..."
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
```bash
# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π
python3 test_analogs_simple.py

# –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ (—Ç—Ä–µ–±—É–µ—Ç playwright)
python3 test_analogs_parsing.py
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `python3 app_new.py`
2. –û—Ç–∫—Ä–æ–π—Ç–µ: `http://localhost:5000`
3. –í—Å—Ç–∞–≤—å—Ç–µ URL –æ–±—ä—è–≤–ª–µ–Ω–∏—è
4. –ù–∞–∂–º–∏—Ç–µ "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π—Ç–∏ –ø–æ—Ö–æ–∂–∏–µ –æ–±—ä–µ–∫—Ç—ã"
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö –∞–Ω–∞–ª–æ–≥–æ–≤

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- ‚úÖ –ë—ã—Å—Ç—Ä–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞ –º¬≤ –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏
- ‚úÖ –ß–µ—Ç–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç)
- ‚úÖ –û—Ü–µ–Ω–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ (—Ç–∏–ø —Ä–µ–º–æ–Ω—Ç–∞)
- ‚úÖ –ë–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –±–µ–∑ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ Cian

### –î–ª—è –∞–Ω–∞–ª–∏–∑–∞:
- ‚úÖ –¢–æ—á–Ω—ã–µ —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç price_per_sqm
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø—É —Ä–µ–º–æ–Ω—Ç–∞

## üîÑ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã:
- –°—Ç–∞—Ä—ã–µ –ø–æ–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- –ù–æ–≤—ã–µ –ø–æ–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã (–º–æ–≥—É—Ç –±—ã—Ç—å `None`)
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:
- **price_per_sqm**: –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å `price_raw` –∏ `area_value`
- **rooms**: –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞, –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º –¥–ª—è –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
- **renovation**: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞–ª–∏—á–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞—Ö Cian

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –¶–µ–Ω–∞ –∑–∞ –º¬≤ –æ–∫—Ä—É–≥–ª—è–µ—Ç—Å—è –¥–æ —Ü–µ–ª—ã—Ö
- –ß–∏—Å–ª–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏ —Ç—ã—Å—è—á (123,874)
- –ü—É—Å—Ç—ã–µ –ø–æ–ª—è –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

## üöÄ –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

–í–æ–∑–º–æ–∂–Ω—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏:
1. –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –ø–æ price_per_sqm
2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É —Ä–µ–º–æ–Ω—Ç–∞
3. –í—ã–¥–µ–ª–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª—å–Ω—ã—Ö —Ü–µ–Ω –∑–∞ –º¬≤
4. –ì—Ä–∞—Ñ–∏–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è price_per_sqm
5. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º —Ä–µ–º–æ–Ω—Ç–∞

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Cian (–º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è)
- –ù–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –æ–±—ä—è–≤–ª–µ–Ω–∏–∏
- –õ–æ–≥–∏ –ø–∞—Ä—Å–µ—Ä–∞ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 2025-11-05
**–í–µ—Ä—Å–∏—è**: 1.0
**–ê–≤—Ç–æ—Ä**: Claude Code Assistant
