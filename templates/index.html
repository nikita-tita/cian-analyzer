<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    {% include '_metrika.html' %}
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Продать квартиру в Москве и СПб — Агентство недвижимости HOUSLER</title>
    <meta name="description" content="Продажа квартиры в Москве и Санкт-Петербурге с полным сопровождением сделки. Проверка документов, профессиональная фотосъёмка, оценка по аналогам, безопасные расчёты. Комиссия 2%, оплата по результату.">
    <meta name="keywords" content="продать квартиру Москва, продать квартиру СПб, агентство недвижимости Москва, агентство недвижимости Санкт-Петербург, продажа квартиры, проверка квартиры, оценка недвижимости, сделка купли-продажи">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Продать квартиру в Москве и СПб — Агентство HOUSLER">
    <meta property="og:description" content="Продажа квартиры в Москве и Санкт-Петербурге с полным сопровождением. Проверка документов, фотосъёмка, оценка, сделка под ключ. Комиссия 2%.">
    <meta property="og:image" content="https://housler.ru/static/images/og-image.png">
    <meta property="og:url" content="https://housler.ru">
    <meta property="og:site_name" content="HOUSLER">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Продать квартиру в Москве и СПб — Агентство HOUSLER">
    <meta name="twitter:description" content="Продажа квартиры в Москве и Санкт-Петербурге с полным сопровождением. Комиссия 2%, оплата по результату.">
    <meta name="twitter:image" content="https://housler.ru/static/images/og-image.png">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://housler.ru">

    <!-- Schema.org structured data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "RealEstateAgent",
        "name": "HOUSLER",
        "alternateName": "Хауслер",
        "description": "Агентство недвижимости в Москве и Санкт-Петербурге. Продажа квартир с полным сопровождением сделки: проверка документов, фотосъёмка, оценка, переговоры, безопасные расчёты.",
        "url": "https://housler.ru",
        "logo": "https://housler.ru/static/images/favicon-512.png",
        "image": "https://housler.ru/static/images/favicon-512.png",
        "telephone": "+7-911-029-55-20",
        "email": "hello@housler.ru",
        "address": {
            "@type": "PostalAddress",
            "addressLocality": "Санкт-Петербург",
            "addressRegion": "Санкт-Петербург",
            "addressCountry": "RU"
        },
        "geo": {
            "@type": "GeoCoordinates",
            "latitude": "59.9343",
            "longitude": "30.3351"
        },
        "areaServed": [
            {
                "@type": "City",
                "name": "Москва"
            },
            {
                "@type": "City",
                "name": "Санкт-Петербург"
            }
        ],
        "priceRange": "2% от стоимости",
        "openingHoursSpecification": {
            "@type": "OpeningHoursSpecification",
            "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
            "opens": "09:00",
            "closes": "21:00"
        },
        "sameAs": [
            "https://t.me/housler_spb"
        ],
        "hasOfferCatalog": {
            "@type": "OfferCatalog",
            "name": "Услуги агентства недвижимости",
            "itemListElement": [
                {
                    "@type": "Offer",
                    "itemOffered": {
                        "@type": "Service",
                        "name": "Продажа квартиры",
                        "description": "Полное сопровождение продажи квартиры: оценка, фотосъёмка, маркетинг, показы, переговоры, сделка"
                    }
                },
                {
                    "@type": "Offer",
                    "itemOffered": {
                        "@type": "Service",
                        "name": "Проверка квартиры",
                        "description": "Юридическая проверка квартиры перед покупкой: ЕГРН, история собственников, обременения"
                    }
                },
                {
                    "@type": "Offer",
                    "itemOffered": {
                        "@type": "Service",
                        "name": "Оценка недвижимости",
                        "description": "Рыночная оценка стоимости квартиры на основе аналогов и аналитики района"
                    }
                }
            ]
        }
    }
    </script>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/static/images/favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/images/favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/images/favicon-16.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/static/images/favicon-192.png">
    <link rel="manifest" href="/static/manifest.json">

    <link rel="stylesheet" href="/static/css/design-system.css?v=20251206a">
    <link rel="stylesheet" href="/static/css/landing.css?v=20251206a">
    <link rel="stylesheet" href="/static/css/pricing-improvements.css?v=20251126">
    <link rel="stylesheet" href="/static/css/pricing-unified.css?v=20251126">
    <link rel="stylesheet" href="/static/css/blog-minimal.css?v=20251126">
    <link rel="stylesheet" href="/static/css/advice-ticker.css?v=20251108210930">
    <link rel="stylesheet" href="/static/css/request-form.css?v=20251126c">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="container">
            <div class="nav-content">
                <div class="logo">HOUSLER</div>
                <div class="nav-links">
                    <a href="#services">Услуги</a>
                    <a href="#pricing">Стоимость</a>
                    <a href="#blog">Блог</a>
                    <a href="#products">Продукты</a>
                </div>
                <button class="mobile-menu-toggle" aria-label="Меню">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay"></div>

    <!-- Mobile Menu -->
    <div class="mobile-menu">
        <a href="#services">Услуги</a>
        <a href="#pricing">Стоимость</a>
        <a href="#blog">Блог</a>
        <a href="#products">Продукты</a>
        <a href="/blog">Все статьи</a>
    </div>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1>Мы делаем недвижимость желанной.</h1>
            <p class="hero-tagline">Продажа квартир в Москве и Санкт-Петербурге</p>
            <p class="hero-subtitle">Чистые документы, сильная подача, правильные покупатели — без лишнего шума.</p>
            <div class="hero-cta">
                <a href="/calculator?reset=1" class="btn btn-primary">Оценить стоимость</a>
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('requestPopup').classList.add('active'); document.body.style.overflow='hidden';">Связаться</button>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section class="section mobile-swipe" id="services">
        <div class="container">
            <h2 class="section-title">Что вы получаете</h2>
            <div class="swipe-container">
                <div class="services-grid">
                    <div class="service-card">
                        <h3>Стратегия вместо суеты</h3>
                        <p>План выхода на рынок: где показываться, как говорить об объекте, когда двигать цену.</p>
                    </div>
                    <div class="service-card">
                        <h3>Визуал, который продает</h3>
                        <p>Съемка, лёгкая подготовка к показам, аккуратная презентация — без лишних эффектов.</p>
                    </div>
                    <div class="service-card">
                        <h3>Честная цена, сильная позиция</h3>
                        <p>Аналитика района, оценка интереса покупателей, обоснование стоимости.</p>
                    </div>
                    <div class="service-card">
                        <h3>Полный контроль сделки</h3>
                        <p>Проверка, переговоры, безопасные расчеты, передача ключей.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Pricing Section -->
    <section class="section" id="pricing">
        <div class="container">
            <h2 class="section-title">Стоимость услуг</h2>

            <div class="pricing-unified">
                <div class="pricing-main-block">
                    <div class="pricing-rate">
                        <div class="rate-amount">2%</div>
                        <div class="rate-description">от стоимости продажи</div>
                        <div class="rate-subtitle">Эксклюзивный договор, оплата по результату</div>
                    </div>

                    <div class="pricing-conditions">
                        <div class="condition-item">Никаких авансов и предоплат</div>
                        <div class="condition-item">Оплата после успешной сделки</div>
                        <div class="condition-item">Полное сопровождение до ключей</div>
                    </div>
                </div>

                <div class="pricing-scope">
                    <div class="scope-title">Что входит в стоимость</div>
                    <div class="scope-grid">
                        <div class="scope-item">
                            <div class="scope-item-title">Подготовка</div>
                            <div class="scope-item-text">Фотосъёмка, видео, 3D-тур</div>
                        </div>
                        <div class="scope-item">
                            <div class="scope-item-title">Аналитика</div>
                            <div class="scope-item-text">Оценка, аналоги, цена</div>
                        </div>
                        <div class="scope-item">
                            <div class="scope-item-title">Маркетинг</div>
                            <div class="scope-item-text">Площадки, продвижение</div>
                        </div>
                        <div class="scope-item">
                            <div class="scope-item-title">Сделка</div>
                            <div class="scope-item-text">Показы, переговоры, оформление</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Why Housler -->
    <section class="section">
        <div class="container">
            <h2 class="section-title">Почему HOUSLER</h2>
            <p class="why-description">Минимум слов, максимум результата. Мы не распыляемся — собираем объект в аккуратную «капсулу»: выверенный сюжет, чистые визуалы, четкая цена. С такими объектами хотят встретиться, о них легко говорить, их удобно покупать.</p>
        </div>
    </section>

    <!-- Blog Section -->
    <section class="section section-gray" id="blog">
        <div class="container">
            <h2 class="section-title">Блог</h2>
            {% if recent_posts %}
            <div class="blog-listing">
                {% for post in recent_posts %}
                <a href="/blog/{{ post.slug }}" class="blog-entry-link">
                    <article class="blog-entry">
                        <div class="blog-entry-meta">{{ post.published_at[:10] }}</div>
                        <h3 class="blog-entry-title">{{ post.title }}</h3>
                        {% if post.excerpt %}
                        <p class="blog-entry-excerpt">{{ post.excerpt }}</p>
                        {% endif %}
                    </article>
                </a>
                {% endfor %}
            </div>
            <div style="text-align: center; margin-top: 2rem;">
                <a href="/blog" class="blog-all-link">Все статьи →</a>
            </div>
            {% else %}
            <p style="text-align: center; color: #666; padding: 2rem 0;">
                Статьи скоро появятся
            </p>
            {% endif %}
        </div>
    </section>

    <!-- Request CTA -->
    <section class="request-cta-section" id="request">
        <div class="container">
            <div class="request-cta-content">
                <h2>Готовы начать?</h2>
                <p>Оставьте заявку — мы свяжемся и обсудим детали</p>
                <button type="button" class="request-cta-btn" id="openRequestPopup" onclick="document.getElementById('requestPopup').classList.add('active'); document.body.style.overflow='hidden'; return false;">Оставить заявку</button>
            </div>
        </div>
    </section>

    <!-- Our Products Section -->
    <section class="section section-gray" id="products">
        <div class="container">
            <h2 class="section-title">Наши продукты</h2>
            <p class="why-description">
                Инструменты для агентов по недвижимости, которые хотят держать всё под контролем
            </p>
            <div class="products-grid">
                <div class="service-card product-card">
                    <div class="product-badge">Telegram Bot</div>
                    <h3>AI Calendar Assistant</h3>
                    <p>Умный помощник для управления расписанием. Голосом или текстом на естественном языке: «Показ на Невском завтра в 15:00» — событие создано.</p>
                    <ul class="product-features">
                        <li>Голосовой ввод через Telegram</li>
                        <li>Напоминания о показах и встречах</li>
                        <li>Поиск свободных слотов в календаре</li>
                    </ul>
                    <a href="https://t.me/aibroker_bot" target="_blank" rel="noopener noreferrer" class="btn btn-primary product-btn">
                        Попробовать бота
                    </a>
                </div>
                <div class="service-card product-card">
                    <div class="product-badge">Web Platform</div>
                    <h3>Новостройки России</h3>
                    <p>Платформа для поиска и бронирования квартир в новостройках. Подборки для клиентов, аналитика просмотров, CRM.</p>
                    <ul class="product-features">
                        <li>90 000+ квартир в базе новостроек</li>
                        <li>Подборки с аналитикой просмотров</li>
                        <li>CRM для ведения клиентов</li>
                    </ul>
                    <a href="https://agent.housler.ru" target="_blank" rel="noopener noreferrer" class="btn btn-primary product-btn">
                        Открыть платформу
                    </a>
                </div>
                <div class="service-card product-card">
                    <div class="product-badge">Free Tool</div>
                    <h3>Оценка квартиры</h3>
                    <p>Собственники часто ошибаются в цене на 10-15%. Узнайте реальную стоимость квартиры за 2 минуты по ссылке с ЦИАН.</p>
                    <ul class="product-features">
                        <li>Сравнение с реальными продажами рядом</li>
                        <li>Прогноз сроков продажи</li>
                        <li>Рекомендации по цене</li>
                    </ul>
                    <a href="/calculator?reset=1" class="btn btn-primary product-btn">
                        Оценить бесплатно
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Advice Ticker -->
    <div class="advice-ticker" id="advice-ticker">
        <div class="advice-ticker-track">
            ЕГРН: права, обременения, запреты на сделки ⚡ История собственников за 10 лет и основания перехода ⚡ Согласие супруга/и при браке или подтверждение раздельности ⚡ Доли и дети: опека, нотариус, выделение долей заранее ⚡ Маткапитал: целевое использование и обязательства на детей ⚡ Ипотека: согласие банка, эскроу/аккредитив, закладная ⚡ Проверка продавца: ФНС, ФССП, банкротство, исполнительные ⚡ Доверенность: реестр, объем полномочий, без перепоручения ⚡ Перепланировка: акты БТИ, узаконивание до сделки ⚡ Ограничения по земле/дому: ПЗЗ, охранные и санитарные зоны ⚡ Судебные споры: проверки по адресу и собственнику ⚡ Долги: коммуналка, капремонт, порядок погашения в договоре ⚡ Третьи лица: зарегистрированные жильцы, арендаторы, право прохода/проезда ⚡ Наследство: все наследники, обязательные доли, сроки принятия ⚡ Налоги: срок владения, НДФЛ, вычет, подтвержденные расходы ⚡ Расчеты: без крупных наличных, только эскроу/аккредитив ⚡ Расписки: дата, сумма, ФИО, паспорт, назначение платежа ⚡ Предварительный договор: предмет, цена, сроки, штрафы ⚡ Электронная регистрация: кто подает, контроль пакета, уведомления ⚡ Земельные границы: межевание, кадастровые ошибки, пересечения соседей ⚡ ЕГРН: права, обременения, запреты на сделки ⚡ История собственников за 10 лет и основания перехода ⚡ Согласие супруга/и при браке или подтверждение раздельности ⚡ Доли и дети: опека, нотариус, выделение долей заранее ⚡ Маткапитал: целевое использование и обязательства на детей ⚡ Ипотека: согласие банка, эскроу/аккредитив, закладная ⚡ Проверка продавца: ФНС, ФССП, банкротство, исполнительные ⚡ Доверенность: реестр, объем полномочий, без перепоручения ⚡ Перепланировка: акты БТИ, узаконивание до сделки ⚡ Ограничения по земле/дому: ПЗЗ, охранные и санитарные зоны ⚡ Судебные споры: проверки по адресу и собственнику ⚡ Долги: коммуналка, капремонт, порядок погашения в договоре ⚡ Третьи лица: зарегистрированные жильцы, арендаторы, право прохода/проезда ⚡ Наследство: все наследники, обязательные доли, сроки принятия ⚡ Налоги: срок владения, НДФЛ, вычет, подтвержденные расходы ⚡ Расчеты: без крупных наличных, только эскроу/аккредитив ⚡ Расписки: дата, сумма, ФИО, паспорт, назначение платежа ⚡ Предварительный договор: предмет, цена, сроки, штрафы ⚡ Электронная регистрация: кто подает, контроль пакета, уведомления ⚡ Земельные границы: межевание, кадастровые ошибки, пересечения соседей
        </div>
    </div>

    <!-- Request Popup -->
    <div class="request-popup-overlay" id="requestPopup">
        <div class="request-popup">
            <div class="request-popup-header">
                <h2>Оставить заявку</h2>
                <button class="request-popup-close" id="closeRequestPopup">&times;</button>
            </div>
            <div class="request-popup-body">
                <!-- Step Indicator -->
                <div class="request-steps">
                    <div class="request-step-dot active" data-step="1"></div>
                    <div class="request-step-dot" data-step="2"></div>
                    <div class="request-step-dot" data-step="3"></div>
                </div>

                <!-- Error Message -->
                <div class="request-error" id="requestError"></div>

                <!-- Step 1: Operation Type -->
                <div class="request-form-step active" data-step="1">
                    <div class="request-step-title">Что вас интересует?</div>
                    <div class="request-options">
                        <label class="request-option">
                            <input type="radio" name="operation" value="buy">
                            <span class="request-option-radio"></span>
                            <span class="request-option-content">
                                <span class="request-option-label">Купить</span>
                                <span class="request-option-desc">Ищу недвижимость для покупки</span>
                            </span>
                        </label>
                        <label class="request-option">
                            <input type="radio" name="operation" value="sell">
                            <span class="request-option-radio"></span>
                            <span class="request-option-content">
                                <span class="request-option-label">Продать</span>
                                <span class="request-option-desc">Хочу продать свою недвижимость</span>
                            </span>
                        </label>
                        <label class="request-option">
                            <input type="radio" name="operation" value="rent">
                            <span class="request-option-radio"></span>
                            <span class="request-option-content">
                                <span class="request-option-label">Сдать</span>
                                <span class="request-option-desc">Хочу сдать в аренду</span>
                            </span>
                        </label>
                    </div>
                    <div class="request-nav">
                        <button class="request-btn request-btn-next" id="toStep2" disabled>Далее</button>
                    </div>
                </div>

                <!-- Step 2: Property Type -->
                <div class="request-form-step" data-step="2">
                    <div class="request-step-title">Тип недвижимости</div>
                    <div class="request-options">
                        <label class="request-option">
                            <input type="radio" name="property_type" value="residential">
                            <span class="request-option-radio"></span>
                            <span class="request-option-content">
                                <span class="request-option-label">Жилая</span>
                                <span class="request-option-desc">Квартира, дом, комната</span>
                            </span>
                        </label>
                        <label class="request-option">
                            <input type="radio" name="property_type" value="commercial">
                            <span class="request-option-radio"></span>
                            <span class="request-option-content">
                                <span class="request-option-label">Коммерческая</span>
                                <span class="request-option-desc">Офис, магазин, склад</span>
                            </span>
                        </label>
                    </div>
                    <div class="request-nav">
                        <button class="request-btn request-btn-back" data-to="1">Назад</button>
                        <button class="request-btn request-btn-next" id="toStep3" disabled>Далее</button>
                    </div>
                </div>

                <!-- Step 3: Contact Info -->
                <div class="request-form-step" data-step="3">
                    <div class="request-step-title">Ваши контакты</div>
                    <div class="request-input-group">
                        <label for="requestName">Имя</label>
                        <input type="text" id="requestName" name="name" placeholder="Как к вам обращаться?" autocomplete="name">
                    </div>
                    <div class="request-input-group">
                        <label for="requestPhone">Телефон</label>
                        <input type="tel" id="requestPhone" name="phone" placeholder="+7 (999) 123-45-67" autocomplete="tel">
                    </div>
                    <div class="request-step-title" style="margin-top: 24px;">Удобный способ связи</div>
                    <div class="request-contact-options">
                        <label class="request-contact-option">
                            <input type="radio" name="contact_method" value="call">
                            <div class="request-contact-label">Позвонить</div>
                        </label>
                        <label class="request-contact-option">
                            <input type="radio" name="contact_method" value="whatsapp">
                            <div class="request-contact-label">WhatsApp</div>
                        </label>
                        <label class="request-contact-option">
                            <input type="radio" name="contact_method" value="telegram">
                            <div class="request-contact-label">Telegram</div>
                        </label>
                    </div>
                    <div class="request-nav">
                        <button class="request-btn request-btn-back" data-to="2">Назад</button>
                        <button class="request-btn request-btn-next" id="submitRequest" disabled>Отправить</button>
                    </div>
                </div>

                <!-- Success State -->
                <div class="request-success" id="requestSuccess">
                    <div class="request-success-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                    </div>
                    <h3>Заявка отправлена!</h3>
                    <p>Мы свяжемся с вами в ближайшее время выбранным способом.</p>
                </div>
            </div>
        </div>
    </div>

    {% include '_footer.html' %}

    <script src="/static/js/advice-ticker.js?v=20251108210930"></script>
    <script>
        // Smooth scroll
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // Mobile menu toggle
        const menuToggle = document.querySelector('.mobile-menu-toggle');
        const mobileMenu = document.querySelector('.mobile-menu');
        const menuOverlay = document.querySelector('.mobile-menu-overlay');
        const body = document.body;

        function toggleMenu() {
            menuToggle.classList.toggle('active');
            mobileMenu.classList.toggle('active');
            menuOverlay.classList.toggle('active');
            body.style.overflow = mobileMenu.classList.contains('active') ? 'hidden' : '';
        }

        menuToggle.addEventListener('click', toggleMenu);
        menuOverlay.addEventListener('click', toggleMenu);

        // Close menu when clicking on a link
        mobileMenu.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', toggleMenu);
        });

        // Request Form Logic
        (function() {
            const popup = document.getElementById('requestPopup');
            const openBtn = document.getElementById('openRequestPopup');
            const closeBtn = document.getElementById('closeRequestPopup');
            const steps = document.querySelectorAll('.request-form-step');
            const stepDots = document.querySelectorAll('.request-step-dot');
            const successEl = document.getElementById('requestSuccess');
            const errorEl = document.getElementById('requestError');

            let currentStep = 1;
            const formData = {
                operation: null,
                property_type: null,
                name: '',
                phone: '',
                contact_method: null
            };

            // Open popup
            openBtn.addEventListener('click', () => {
                popup.classList.add('active');
                document.body.style.overflow = 'hidden';
            });

            // Close popup
            function closePopup() {
                popup.classList.remove('active');
                document.body.style.overflow = '';
                // Reset form after animation
                setTimeout(resetForm, 300);
            }

            closeBtn.addEventListener('click', closePopup);
            popup.addEventListener('click', (e) => {
                if (e.target === popup) closePopup();
            });

            // Reset form
            function resetForm() {
                currentStep = 1;
                formData.operation = null;
                formData.property_type = null;
                formData.name = '';
                formData.phone = '';
                formData.contact_method = null;

                document.querySelectorAll('.request-option, .request-contact-option').forEach(el => {
                    el.classList.remove('selected');
                });
                document.querySelectorAll('input[type="radio"]').forEach(el => {
                    el.checked = false;
                });
                document.getElementById('requestName').value = '';
                document.getElementById('requestPhone').value = '';

                updateSteps();
                successEl.classList.remove('active');
                errorEl.classList.remove('active');
                document.querySelector('.request-steps').style.display = '';
            }

            // Update step visibility
            function updateSteps() {
                steps.forEach(step => {
                    step.classList.remove('active');
                    if (parseInt(step.dataset.step) === currentStep) {
                        step.classList.add('active');
                    }
                });

                stepDots.forEach(dot => {
                    const dotStep = parseInt(dot.dataset.step);
                    dot.classList.remove('active', 'completed');
                    if (dotStep === currentStep) {
                        dot.classList.add('active');
                    } else if (dotStep < currentStep) {
                        dot.classList.add('completed');
                    }
                });

                updateButtons();
            }

            // Update button states
            function updateButtons() {
                document.getElementById('toStep2').disabled = !formData.operation;
                document.getElementById('toStep3').disabled = !formData.property_type;

                const canSubmit = formData.name.trim() &&
                                  formData.phone.trim() &&
                                  formData.contact_method;
                document.getElementById('submitRequest').disabled = !canSubmit;
            }

            // Handle option selection
            document.querySelectorAll('.request-option').forEach(option => {
                option.addEventListener('click', () => {
                    const input = option.querySelector('input');
                    const name = input.name;
                    const value = input.value;

                    // Update visual state
                    option.closest('.request-options').querySelectorAll('.request-option').forEach(o => {
                        o.classList.remove('selected');
                    });
                    option.classList.add('selected');
                    input.checked = true;

                    // Update form data
                    formData[name] = value;
                    updateButtons();
                });
            });

            // Handle contact method selection
            document.querySelectorAll('.request-contact-option').forEach(option => {
                option.addEventListener('click', () => {
                    const input = option.querySelector('input');

                    document.querySelectorAll('.request-contact-option').forEach(o => {
                        o.classList.remove('selected');
                    });
                    option.classList.add('selected');
                    input.checked = true;

                    formData.contact_method = input.value;
                    updateButtons();
                });
            });

            // Handle input fields
            document.getElementById('requestName').addEventListener('input', (e) => {
                formData.name = e.target.value;
                updateButtons();
            });

            document.getElementById('requestPhone').addEventListener('input', (e) => {
                formData.phone = e.target.value;
                updateButtons();
            });

            // Navigation
            document.getElementById('toStep2').addEventListener('click', () => {
                currentStep = 2;
                updateSteps();
            });

            document.getElementById('toStep3').addEventListener('click', () => {
                currentStep = 3;
                updateSteps();
            });

            document.querySelectorAll('.request-btn-back').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentStep = parseInt(btn.dataset.to);
                    updateSteps();
                });
            });

            // Submit form
            document.getElementById('submitRequest').addEventListener('click', async () => {
                const submitBtn = document.getElementById('submitRequest');
                submitBtn.classList.add('loading');
                submitBtn.disabled = true;
                errorEl.classList.remove('active');

                try {
                    const response = await fetch('/api/client-request', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });

                    const result = await response.json();

                    if (response.ok && result.success) {
                        // Show success
                        steps.forEach(s => s.classList.remove('active'));
                        document.querySelector('.request-steps').style.display = 'none';
                        successEl.classList.add('active');

                        // Close popup after delay
                        setTimeout(closePopup, 3000);
                    } else {
                        throw new Error(result.error || 'Ошибка отправки');
                    }
                } catch (error) {
                    errorEl.textContent = error.message || 'Произошла ошибка. Попробуйте позже.';
                    errorEl.classList.add('active');
                } finally {
                    submitBtn.classList.remove('loading');
                    updateButtons();
                }
            });

            // Escape key to close
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && popup.classList.contains('active')) {
                    closePopup();
                }
            });
        })();
    </script>
</body>
</html>
