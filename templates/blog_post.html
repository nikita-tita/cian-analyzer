<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ post.title }} ‚Äî HOUSLER</title>
    <meta name="description" content="{{ post.excerpt or post.content[:200] }}">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="{{ post.title }}">
    <meta property="og:description" content="{{ post.excerpt or post.content[:200] }}">
    <meta property="og:url" content="https://housler.ru/blog/{{ post.slug }}">
    <meta property="og:site_name" content="HOUSLER ‚Äî –ê–≥–µ–Ω—Ç—Å—Ç–≤–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏">
    <meta property="article:published_time" content="{{ post.published_at }}">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ post.title }}">
    <meta name="twitter:description" content="{{ post.excerpt or post.content[:200] }}">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://housler.ru/blog/{{ post.slug }}">

    <!-- Schema.org Article structured data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": "{{ post.title }}",
        "description": "{{ post.excerpt or post.content[:200] | e }}",
        "datePublished": "{{ post.published_at }}",
        "dateModified": "{{ post.updated_at or post.published_at }}",
        "author": {
            "@type": "Organization",
            "name": "HOUSLER",
            "url": "https://housler.ru"
        },
        "publisher": {
            "@type": "Organization",
            "name": "HOUSLER",
            "logo": {
                "@type": "ImageObject",
                "url": "https://housler.ru/static/images/favicon-512.png"
            }
        },
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://housler.ru/blog/{{ post.slug }}"
        },
        "articleSection": "–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å",
        "inLanguage": "ru-RU"
    }
    </script>

    <!-- BreadcrumbList structured data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "–ì–ª–∞–≤–Ω–∞—è",
                "item": "https://housler.ru"
            },
            {
                "@type": "ListItem",
                "position": 2,
                "name": "–ë–ª–æ–≥",
                "item": "https://housler.ru/blog"
            },
            {
                "@type": "ListItem",
                "position": 3,
                "name": "{{ post.title }}",
                "item": "https://housler.ru/blog/{{ post.slug }}"
            }
        ]
    }
    </script>

    <link rel="icon" type="image/svg+xml" href="/static/images/favicon.svg">
    <link rel="stylesheet" href="/static/css/landing.css?v=20251126">
    <link rel="stylesheet" href="/static/css/blog-minimal.css?v=20251126">
    <link rel="stylesheet" href="/static/css/blog-post.css?v=20251126">
    <link rel="stylesheet" href="/static/css/request-form.css?v=20251126b">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="container">
            <div class="nav-content">
                <a href="/" class="logo">HOUSLER</a>
                <div class="nav-links">
                    <a href="/#services">–£—Å–ª—É–≥–∏</a>
                    <a href="/#pricing">–°—Ç–æ–∏–º–æ—Å—Ç—å</a>
                    <a href="/blog">–ë–ª–æ–≥</a>
                    <a href="/#contact">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
                </div>
                <button class="mobile-menu-toggle" aria-label="–ú–µ–Ω—é">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay"></div>

    <!-- Mobile Menu -->
    <div class="mobile-menu">
        <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/#services">–£—Å–ª—É–≥–∏</a>
        <a href="/#pricing">–°—Ç–æ–∏–º–æ—Å—Ç—å</a>
        <a href="/blog">–ë–ª–æ–≥</a>
        <a href="/#contact">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
    </div>

    <!-- Blog Post -->
    <section class="section">
        <div class="container">
            <!-- Breadcrumbs -->
            <nav class="breadcrumbs" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
                <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
                <span class="breadcrumb-sep">‚Üí</span>
                <a href="/blog">–ë–ª–æ–≥</a>
                <span class="breadcrumb-sep">‚Üí</span>
                <span class="breadcrumb-current">{{ post.title[:50] }}{% if post.title|length > 50 %}...{% endif %}</span>
            </nav>

            <div class="blog-post-content">
                <div class="blog-post-header">
                    <div class="blog-post-meta">{{ post.published_at[:10] }}</div>
                    <h1 class="blog-post-title">{{ post.title }}</h1>
                    {% if post.excerpt %}
                    <div class="blog-post-excerpt">{{ post.excerpt }}</div>
                    {% endif %}
                </div>

                <div class="blog-post-body">
                    {{ post.content_html | safe }}
                </div>

                <div class="blog-post-footer">
                    <a href="/blog" class="back-to-blog">‚Üê –í—Å–µ —Å—Ç–∞—Ç—å–∏</a>
                </div>

                <!-- CTA Block for internal linking -->
                <div class="blog-cta-block">
                    <h3>–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å—é?</h3>
                    <p>HOUSLER ‚Äî –∞–≥–µ–Ω—Ç—Å—Ç–≤–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ —Å –ø–æ–ª–Ω—ã–º —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ–º —Å–¥–µ–ª–∫–∏</p>
                    <div class="blog-cta-links">
                        <a href="/" class="blog-cta-link">–£–∑–Ω–∞—Ç—å –æ–± —É—Å–ª—É–≥–∞—Ö</a>
                        <a href="/calculator?reset=1" class="blog-cta-link">–û—Ü–µ–Ω–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É</a>
                        <button type="button" class="blog-cta-link" id="openRequestPopup">–°–≤—è–∑–∞—Ç—å—Å—è</button>
                    </div>
                </div>
            </div>

            {% if recent_posts %}
            <!-- Related Posts -->
            <div class="related-posts">
                <h2 class="related-posts-title">–ß–∏—Ç–∞–π—Ç–µ —Ç–∞–∫–∂–µ</h2>
                <div class="related-posts-grid">
                    {% for related_post in recent_posts[:3] %}
                        {% if related_post.slug != post.slug %}
                        <a href="/blog/{{ related_post.slug }}" class="related-post-card">
                            <div class="related-post-meta">{{ related_post.published_at[:10] }}</div>
                            <h3 class="related-post-title">{{ related_post.title }}</h3>
                            {% if related_post.excerpt %}
                            <p class="related-post-excerpt">{{ related_post.excerpt[:120] }}...</p>
                            {% endif %}
                        </a>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </section>

    <!-- Request Popup -->
    <div class="request-popup-overlay" id="requestPopup">
        <div class="request-popup">
            <div class="request-popup-header">
                <h2>–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</h2>
                <button class="request-popup-close" id="closeRequestPopup">&times;</button>
            </div>
            <div class="request-popup-body">
                <div class="request-steps">
                    <div class="request-step-dot active" data-step="1"></div>
                    <div class="request-step-dot" data-step="2"></div>
                    <div class="request-step-dot" data-step="3"></div>
                </div>
                <div class="request-error" id="requestError"></div>
                <div class="request-form-step active" data-step="1">
                    <div class="request-step-title">–ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?</div>
                    <div class="request-options">
                        <label class="request-option">
                            <input type="radio" name="operation" value="buy">
                            <span class="request-option-radio"></span>
                            <span class="request-option-content">
                                <span class="request-option-label">–ö—É–ø–∏—Ç—å</span>
                                <span class="request-option-desc">–ò—â—É –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –¥–ª—è –ø–æ–∫—É–ø–∫–∏</span>
                            </span>
                        </label>
                        <label class="request-option">
                            <input type="radio" name="operation" value="sell">
                            <span class="request-option-radio"></span>
                            <span class="request-option-content">
                                <span class="request-option-label">–ü—Ä–æ–¥–∞—Ç—å</span>
                                <span class="request-option-desc">–•–æ—á—É –ø—Ä–æ–¥–∞—Ç—å —Å–≤–æ—é –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</span>
                            </span>
                        </label>
                        <label class="request-option">
                            <input type="radio" name="operation" value="rent">
                            <span class="request-option-radio"></span>
                            <span class="request-option-content">
                                <span class="request-option-label">–°–¥–∞—Ç—å</span>
                                <span class="request-option-desc">–•–æ—á—É —Å–¥–∞—Ç—å –≤ –∞—Ä–µ–Ω–¥—É</span>
                            </span>
                        </label>
                    </div>
                    <div class="request-nav">
                        <button class="request-btn request-btn-next" id="toStep2" disabled>–î–∞–ª–µ–µ</button>
                    </div>
                </div>
                <div class="request-form-step" data-step="2">
                    <div class="request-step-title">–¢–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</div>
                    <div class="request-options">
                        <label class="request-option">
                            <input type="radio" name="property_type" value="residential">
                            <span class="request-option-radio"></span>
                            <span class="request-option-content">
                                <span class="request-option-label">–ñ–∏–ª–∞—è</span>
                                <span class="request-option-desc">–ö–≤–∞—Ä—Ç–∏—Ä–∞, –¥–æ–º, –∫–æ–º–Ω–∞—Ç–∞</span>
                            </span>
                        </label>
                        <label class="request-option">
                            <input type="radio" name="property_type" value="commercial">
                            <span class="request-option-radio"></span>
                            <span class="request-option-content">
                                <span class="request-option-label">–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è</span>
                                <span class="request-option-desc">–û—Ñ–∏—Å, –º–∞–≥–∞–∑–∏–Ω, —Å–∫–ª–∞–¥</span>
                            </span>
                        </label>
                    </div>
                    <div class="request-nav">
                        <button class="request-btn request-btn-back" data-to="1">–ù–∞–∑–∞–¥</button>
                        <button class="request-btn request-btn-next" id="toStep3" disabled>–î–∞–ª–µ–µ</button>
                    </div>
                </div>
                <div class="request-form-step" data-step="3">
                    <div class="request-step-title">–í–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã</div>
                    <div class="request-input-group">
                        <label for="requestName">–ò–º—è</label>
                        <input type="text" id="requestName" name="name" placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?" autocomplete="name">
                    </div>
                    <div class="request-input-group">
                        <label for="requestPhone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" id="requestPhone" name="phone" placeholder="+7 (999) 123-45-67" autocomplete="tel">
                    </div>
                    <div class="request-step-title" style="margin-top: 24px;">–£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏</div>
                    <div class="request-contact-options">
                        <label class="request-contact-option">
                            <input type="radio" name="contact_method" value="call">
                            <div class="request-contact-icon">üìû</div>
                            <div class="request-contact-label">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</div>
                        </label>
                        <label class="request-contact-option">
                            <input type="radio" name="contact_method" value="whatsapp">
                            <div class="request-contact-icon">üí¨</div>
                            <div class="request-contact-label">WhatsApp</div>
                        </label>
                        <label class="request-contact-option">
                            <input type="radio" name="contact_method" value="telegram">
                            <div class="request-contact-icon">‚úàÔ∏è</div>
                            <div class="request-contact-label">Telegram</div>
                        </label>
                    </div>
                    <div class="request-nav">
                        <button class="request-btn request-btn-back" data-to="2">–ù–∞–∑–∞–¥</button>
                        <button class="request-btn request-btn-next" id="submitRequest" disabled>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                    </div>
                </div>
                <div class="request-success" id="requestSuccess">
                    <div class="request-success-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                    </div>
                    <h3>–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h3>
                    <p>–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">HOUSLER</div>
                <div class="footer-text">¬© 2025 –ê–≥–µ–Ω—Ç—Å—Ç–≤–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</div>
            </div>
        </div>
    </footer>

    {% include '_metrika.html' %}

    <script>
        // Mobile menu toggle
        const menuToggle = document.querySelector('.mobile-menu-toggle');
        const mobileMenu = document.querySelector('.mobile-menu');
        const menuOverlay = document.querySelector('.mobile-menu-overlay');
        const body = document.body;

        function toggleMenu() {
            menuToggle.classList.toggle('active');
            mobileMenu.classList.toggle('active');
            menuOverlay.classList.toggle('active');
            body.style.overflow = mobileMenu.classList.contains('active') ? 'hidden' : '';
        }

        menuToggle.addEventListener('click', toggleMenu);
        menuOverlay.addEventListener('click', toggleMenu);

        // Close menu when clicking on a link
        mobileMenu.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', toggleMenu);
        });

        // Request Form Logic
        (function() {
            const popup = document.getElementById('requestPopup');
            const closeBtn = document.getElementById('closeRequestPopup');
            const steps = document.querySelectorAll('.request-form-step');
            const stepDots = document.querySelectorAll('.request-step-dot');
            const successEl = document.getElementById('requestSuccess');
            const errorEl = document.getElementById('requestError');

            let currentStep = 1;
            const formData = {
                operation: null,
                property_type: null,
                name: '',
                phone: '',
                contact_method: null
            };

            function closePopup() {
                popup.classList.remove('active');
                document.body.style.overflow = '';
                setTimeout(resetForm, 300);
            }

            // Open popup button
            const openBtn = document.getElementById('openRequestPopup');
            if (openBtn) {
                openBtn.addEventListener('click', () => {
                    popup.classList.add('active');
                    document.body.style.overflow = 'hidden';
                });
            }

            closeBtn.addEventListener('click', closePopup);
            popup.addEventListener('click', (e) => {
                if (e.target === popup) closePopup();
            });

            function resetForm() {
                currentStep = 1;
                formData.operation = null;
                formData.property_type = null;
                formData.name = '';
                formData.phone = '';
                formData.contact_method = null;

                document.querySelectorAll('.request-option, .request-contact-option').forEach(el => {
                    el.classList.remove('selected');
                });
                document.querySelectorAll('input[type="radio"]').forEach(el => {
                    el.checked = false;
                });
                document.getElementById('requestName').value = '';
                document.getElementById('requestPhone').value = '';

                updateSteps();
                successEl.classList.remove('active');
                errorEl.classList.remove('active');
                document.querySelector('.request-steps').style.display = '';
            }

            function updateSteps() {
                steps.forEach(step => {
                    step.classList.remove('active');
                    if (parseInt(step.dataset.step) === currentStep) {
                        step.classList.add('active');
                    }
                });

                stepDots.forEach(dot => {
                    const dotStep = parseInt(dot.dataset.step);
                    dot.classList.remove('active', 'completed');
                    if (dotStep === currentStep) {
                        dot.classList.add('active');
                    } else if (dotStep < currentStep) {
                        dot.classList.add('completed');
                    }
                });

                updateButtons();
            }

            function updateButtons() {
                document.getElementById('toStep2').disabled = !formData.operation;
                document.getElementById('toStep3').disabled = !formData.property_type;

                const canSubmit = formData.name.trim() &&
                                  formData.phone.trim() &&
                                  formData.contact_method;
                document.getElementById('submitRequest').disabled = !canSubmit;
            }

            document.querySelectorAll('.request-option').forEach(option => {
                option.addEventListener('click', () => {
                    const input = option.querySelector('input');
                    const name = input.name;
                    const value = input.value;

                    option.closest('.request-options').querySelectorAll('.request-option').forEach(o => {
                        o.classList.remove('selected');
                    });
                    option.classList.add('selected');
                    input.checked = true;

                    formData[name] = value;
                    updateButtons();
                });
            });

            document.querySelectorAll('.request-contact-option').forEach(option => {
                option.addEventListener('click', () => {
                    const input = option.querySelector('input');

                    document.querySelectorAll('.request-contact-option').forEach(o => {
                        o.classList.remove('selected');
                    });
                    option.classList.add('selected');
                    input.checked = true;

                    formData.contact_method = input.value;
                    updateButtons();
                });
            });

            document.getElementById('requestName').addEventListener('input', (e) => {
                formData.name = e.target.value;
                updateButtons();
            });

            document.getElementById('requestPhone').addEventListener('input', (e) => {
                formData.phone = e.target.value;
                updateButtons();
            });

            document.getElementById('toStep2').addEventListener('click', () => {
                currentStep = 2;
                updateSteps();
            });

            document.getElementById('toStep3').addEventListener('click', () => {
                currentStep = 3;
                updateSteps();
            });

            document.querySelectorAll('.request-btn-back').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentStep = parseInt(btn.dataset.to);
                    updateSteps();
                });
            });

            document.getElementById('submitRequest').addEventListener('click', async () => {
                const submitBtn = document.getElementById('submitRequest');
                submitBtn.classList.add('loading');
                submitBtn.disabled = true;
                errorEl.classList.remove('active');

                try {
                    const response = await fetch('/api/client-request', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });

                    const result = await response.json();

                    if (response.ok && result.success) {
                        steps.forEach(s => s.classList.remove('active'));
                        document.querySelector('.request-steps').style.display = 'none';
                        successEl.classList.add('active');

                        setTimeout(closePopup, 3000);
                    } else {
                        throw new Error(result.error || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');
                    }
                } catch (error) {
                    errorEl.textContent = error.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
                    errorEl.classList.add('active');
                } finally {
                    submitBtn.classList.remove('loading');
                    updateButtons();
                }
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && popup.classList.contains('active')) {
                    closePopup();
                }
            });
        })();
    </script>
</body>
</html>
