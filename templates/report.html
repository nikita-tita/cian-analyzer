<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç—á–µ—Ç –ø–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ ‚Äî Housler</title>

    <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ –∂–µ —Å—Ç–∏–ª–∏ —á—Ç–æ –∏ –Ω–∞ —Å–∞–π—Ç–µ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/design-system.css?v=20251111113154">
    <link rel="stylesheet" href="/static/css/wizard.css?v=20251111113154">

    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–µ—á–∞—Ç–∏/PDF */
        @media print {
            .no-print {
                display: none !important;
            }
        }

        body {
            background: white;
            padding: 40px 20px;
        }

        .report-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
        }

        .report-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid #000;
        }

        .report-logo {
            font-size: 36px;
            font-weight: 600;
            letter-spacing: -0.02em;
            margin-bottom: 10px;
        }

        .report-date {
            color: #666;
            font-size: 14px;
        }

        .section {
            margin-bottom: 50px;
            page-break-inside: avoid;
        }

        .section-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .subsection-title {
            font-size: 18px;
            font-weight: 600;
            margin: 20px 0 15px 0;
        }

        .info-card {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 500;
            color: #666;
        }

        .info-value {
            font-weight: 600;
        }

        .recommendation-card {
            background: white;
            border-left: 4px solid #000;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .recommendation-card.critical {
            border-left-color: #dc3545;
        }

        .recommendation-card.high {
            border-left-color: #fd7e14;
        }

        .recommendation-card.medium {
            border-left-color: #ffc107;
        }

        .recommendation-card.info {
            border-left-color: #0dcaf0;
        }

        .recommendation-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 8px;
        }

        .recommendation-message {
            color: #666;
            margin-bottom: 8px;
        }

        .recommendation-action {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }

        .comparable-item {
            padding: 10px;
            background: #f8f9fa;
            margin-bottom: 10px;
            border-radius: 4px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .status-overpriced {
            background: #fee;
            color: #c00;
        }

        .status-fair {
            background: #efe;
            color: #060;
        }

        .status-underpriced {
            background: #eef;
            color: #006;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f5f5f5;
            font-weight: 600;
        }

        .footer {
            margin-top: 60px;
            padding-top: 30px;
            border-top: 2px solid #000;
            text-align: center;
            color: #666;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="report-container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="report-header">
            <div class="report-logo">HOUSLER</div>
            <div class="report-date">–û—Ç—á–µ—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏<br>{{ date }}</div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—ä–µ–∫—Ç–µ -->
        <div class="section">
            <h2 class="section-title">üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—ä–µ–∫—Ç–µ</h2>

            <div class="info-card">
                <h3 class="subsection-title">–í–∞—à –æ–±—ä–µ–∫—Ç</h3>
                {% if property_info %}
                <div class="info-row">
                    <span class="info-label">–¶–µ–Ω–∞</span>
                    <span class="info-value">{{ "{:,.0f}".format(property_info.price) }} ‚ÇΩ</span>
                </div>
                <div class="info-row">
                    <span class="info-label">–ü–ª–æ—â–∞–¥—å</span>
                    <span class="info-value">{{ property_info.total_area }} –º¬≤</span>
                </div>
                {% if property_info.living_area %}
                <div class="info-row">
                    <span class="info-label">–ñ–∏–ª–∞—è –ø–ª–æ—â–∞–¥—å</span>
                    <span class="info-value">{{ property_info.living_area }} –º¬≤</span>
                </div>
                {% endif %}
                <div class="info-row">
                    <span class="info-label">–ö–æ–º–Ω–∞—Ç</span>
                    <span class="info-value">{{ property_info.rooms }}</span>
                </div>
                {% if property_info.floor and property_info.total_floors %}
                <div class="info-row">
                    <span class="info-label">–≠—Ç–∞–∂</span>
                    <span class="info-value">{{ property_info.floor }}/{{ property_info.total_floors }}</span>
                </div>
                {% endif %}
                {% if property_info.address %}
                <div class="info-row">
                    <span class="info-label">–ê–¥—Ä–µ—Å</span>
                    <span class="info-value">{{ property_info.address }}</span>
                </div>
                {% endif %}
                {% if property_info.repair_level %}
                <div class="info-row">
                    <span class="info-label">–†–µ–º–æ–Ω—Ç</span>
                    <span class="info-value">{{ property_info.repair_level }}</span>
                </div>
                {% endif %}
                {% endif %}
            </div>

            {% if comparables and comparables|length > 0 %}
            <h3 class="subsection-title">–ê–Ω–∞–ª–æ–≥–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è</h3>
            <p>–ù–∞–π–¥–µ–Ω–æ <strong>{{ comparables|length }} –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤</strong> –≤ —Ç–æ–º –∂–µ —Ä–∞–π–æ–Ω–µ.</p>

            <table>
                <thead>
                    <tr>
                        <th>‚Ññ</th>
                        <th>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</th>
                        <th>–¶–µ–Ω–∞</th>
                        <th>–¶–µ–Ω–∞ –∑–∞ –º¬≤</th>
                    </tr>
                </thead>
                <tbody>
                    {% for comp in comparables[:10] %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ comp.rooms }}-–∫–æ–º–Ω., {{ comp.total_area }} –º¬≤, {{ comp.floor }}/{{ comp.total_floors }} —ç—Ç.</td>
                        <td>{{ "{:,.0f}".format(comp.price) }} ‚ÇΩ</td>
                        <td>{{ "{:,.0f}".format(comp.price_per_sqm) }} ‚ÇΩ</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if comparables|length > 10 %}
            <p style="color: #666; font-size: 14px;">... –∏ –µ—â–µ {{ comparables|length - 10 }} –æ–±—ä–µ–∫—Ç–æ–≤</p>
            {% endif %}
            {% endif %}
        </div>

        <!-- –ì–ª–∞–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã -->
        <div class="section">
            <h2 class="section-title">üéØ –ì–ª–∞–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã</h2>

            <div class="info-card">
                {% if fair_price_analysis %}
                <div class="info-row">
                    <span class="info-label">–°—Ç–∞—Ç—É—Å —Ü–µ–Ω—ã</span>
                    <span class="info-value">
                        {% if fair_price_analysis.is_fair %}
                        <span class="status-badge status-fair">–°–ü–†–ê–í–ï–î–õ–ò–í–ê–Ø</span>
                        {% elif fair_price_analysis.is_overpriced %}
                        <span class="status-badge status-overpriced">–ó–ê–í–´–®–ï–ù–ê –Ω–∞ {{ "%.1f"|format(fair_price_analysis.overpricing_percent|abs) }}%</span>
                        {% elif fair_price_analysis.is_underpriced %}
                        <span class="status-badge status-underpriced">–ó–ê–ù–ò–ñ–ï–ù–ê –Ω–∞ {{ "%.1f"|format(fair_price_analysis.price_diff_percent|abs) }}%</span>
                        {% endif %}
                    </span>
                </div>
                <div class="info-row">
                    <span class="info-label">–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–∞—è —Ü–µ–Ω–∞</span>
                    <span class="info-value">{{ "{:,.0f}".format(fair_price_analysis.fair_price_total) }} ‚ÇΩ</span>
                </div>
                <div class="info-row">
                    <span class="info-label">–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞</span>
                    <span class="info-value">{{ "{:,.0f}".format(property_info.price) }} ‚ÇΩ</span>
                </div>
                {% endif %}

                {% if time_forecast %}
                <div class="info-row">
                    <span class="info-label">–ü—Ä–æ–≥–Ω–æ–∑ –ø—Ä–æ–¥–∞–∂–∏</span>
                    <span class="info-value">{{ time_forecast.time_range_description }}</span>
                </div>
                {% endif %}

                {% if attractiveness_index %}
                <div class="info-row">
                    <span class="info-label">–ü—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å</span>
                    <span class="info-value">{{ "%.0f"|format(attractiveness_index.total_index) }}/100 ({{ attractiveness_index.category }})</span>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
        {% if recommendations and recommendations|length > 0 %}
        <div class="section">
            <h2 class="section-title">üí° –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h2>

            <p style="margin-bottom: 20px;">–ù–∞ –æ—Å–Ω–æ–≤–µ –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤–∞—à–µ–≥–æ –æ–±—ä–µ–∫—Ç–∞:</p>

            {% for rec in recommendations %}
            <div class="recommendation-card {% if rec.priority == 1 %}critical{% elif rec.priority == 2 %}high{% elif rec.priority == 3 %}medium{% else %}info{% endif %}">
                <div class="recommendation-title">
                    {{ rec.icon }} {{ rec.title }}
                </div>
                {% if rec.message %}
                <div class="recommendation-message">
                    {{ rec.message }}
                </div>
                {% endif %}
                {% if rec.action %}
                <div class="recommendation-action">
                    <strong>–î–µ–π—Å—Ç–≤–∏–µ:</strong> {{ rec.action }}
                </div>
                {% endif %}
                {% if rec.roi and rec.roi > 0 %}
                <div style="margin-top: 8px; color: #198754; font-weight: 600;">
                    <i class="bi bi-graph-up-arrow"></i> –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –≤—ã–≥–æ–¥–∞: {{ "{:,.0f}".format(rec.roi) }} ‚ÇΩ
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- –†—ã–Ω–æ—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        {% if market_statistics %}
        <div class="section">
            <h2 class="section-title">üìä –†—ã–Ω–æ—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>

            <div class="info-card">
                <div class="info-row">
                    <span class="info-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–Ω–∞–ª–æ–≥–æ–≤</span>
                    <span class="info-value">{{ market_statistics.all.count }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">–ú–µ–¥–∏–∞–Ω–∞ —Ü–µ–Ω—ã –∑–∞ –º¬≤</span>
                    <span class="info-value">{{ "{:,.0f}".format(market_statistics.all.median) }} ‚ÇΩ</span>
                </div>
                <div class="info-row">
                    <span class="info-label">–°—Ä–µ–¥–Ω–µ–µ</span>
                    <span class="info-value">{{ "{:,.0f}".format(market_statistics.all.mean) }} ‚ÇΩ</span>
                </div>
                <div class="info-row">
                    <span class="info-label">–ú–∏–Ω–∏–º—É–º</span>
                    <span class="info-value">{{ "{:,.0f}".format(market_statistics.all.min) }} ‚ÇΩ</span>
                </div>
                <div class="info-row">
                    <span class="info-label">–ú–∞–∫—Å–∏–º—É–º</span>
                    <span class="info-value">{{ "{:,.0f}".format(market_statistics.all.max) }} ‚ÇΩ</span>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- –°—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ–¥–∞–∂–∏ -->
        {% if price_scenarios and price_scenarios|length > 0 %}
        <div class="section">
            <h2 class="section-title">üìà –°—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ–¥–∞–∂–∏</h2>

            {% for scenario in price_scenarios %}
            <div class="info-card">
                <h3 class="subsection-title">{{ scenario.name }}</h3>
                <p><em>{{ scenario.description }}</em></p>

                <div class="info-row">
                    <span class="info-label">–ù–∞—á–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞</span>
                    <span class="info-value">{{ "{:,.0f}".format(scenario.start_price) }} ‚ÇΩ</span>
                </div>
                <div class="info-row">
                    <span class="info-label">–û–∂–∏–¥–∞–µ–º–∞—è —Ñ–∏–Ω–∞–ª—å–Ω–∞—è</span>
                    <span class="info-value">{{ "{:,.0f}".format(scenario.expected_final_price) }} ‚ÇΩ</span>
                </div>
                <div class="info-row">
                    <span class="info-label">–í—Ä–µ–º—è –ø—Ä–æ–¥–∞–∂–∏</span>
                    <span class="info-value">{{ scenario.time_months }} –º–µ—Å.</span>
                </div>
                {% if scenario.financials %}
                <div class="info-row">
                    <span class="info-label">–ß–∏—Å—Ç—ã–π –¥–æ—Ö–æ–¥</span>
                    <span class="info-value">{{ "{:,.0f}".format(scenario.financials.net_after_opportunity) }} ‚ÇΩ</span>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- –§—É—Ç–µ—Ä -->
        <div class="footer">
            <p>–≠—Ç–æ—Ç –æ—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω —Å–∏—Å—Ç–µ–º–æ–π <strong>HOUSLER</strong> ‚Äî –∞–Ω–∞–ª–∏–∑ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.</p>
            <p>–û—Ç—á–µ—Ç –Ω–æ—Å–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π.</p>
            <p>¬© {{ date[:4] }} HOUSLER. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </div>
    </div>
</body>
</html>
