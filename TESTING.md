# üß™ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é Housler

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö:

- **Unit —Ç–µ—Å—Ç—ã** - –º–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **API —Ç–µ—Å—Ç—ã** - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ REST API endpoints
- **Security —Ç–µ—Å—Ç—ã** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (CSRF, XSS, Rate Limiting)
- **E2E —Ç–µ—Å—Ç—ã** - end-to-end —Ç–µ—Å—Ç—ã –ø–æ–ª–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—É—Ç–∏

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ —Å –æ—Ç—á–µ—Ç–æ–º
./scripts/run_full_test_suite.sh

# –¢–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã
pytest tests/ --ignore=tests/test_e2e_full_flow.py -v

# –¢–æ–ª—å–∫–æ E2E —Ç–µ—Å—Ç—ã
pytest tests/test_e2e_full_flow.py -v

# –° coverage
pytest tests/ --cov=src --cov-report=html
```

### –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–µ–ø–ª–æ—è

```bash
# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö endpoint'–æ–≤
./scripts/post_deploy_check.sh

# –ü–æ–ª–Ω–∞—è E2E –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
RUN_FULL_E2E=true ./scripts/post_deploy_check.sh
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ test_session_storage.py      # Session management —Å Redis
‚îú‚îÄ‚îÄ test_browser_pool.py          # Playwright browser pool
‚îú‚îÄ‚îÄ test_fair_price_calculator.py # –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–π —Ü–µ–Ω—ã
‚îú‚îÄ‚îÄ test_api.py                   # REST API endpoints
‚îú‚îÄ‚îÄ test_security.py              # Security (CSRF, XSS, Rate Limiting)
‚îú‚îÄ‚îÄ test_new_analytics.py         # Analytics engine
‚îî‚îÄ‚îÄ test_e2e_full_flow.py         # E2E –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

## E2E —Ç–µ—Å—Ç—ã (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å)

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:

‚úÖ **–¢–µ—Å—Ç 1: –õ–µ–Ω–¥–∏–Ω–≥ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- HTTP 200 status
- –ù–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤

‚úÖ **–¢–µ—Å—Ç 2: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è**
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å /wizard
- –ù–∞–ª–∏—á–∏–µ —Ñ–æ—Ä–º –∏ –∫–Ω–æ–ø–æ–∫

‚úÖ **–¢–µ—Å—Ç 3: –ü–∞—Ä—Å–∏–Ω–≥ –æ–±—ä–µ–∫—Ç–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏**
- POST /api/parse
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã:
  - price (–Ω–µ 0 –∏ –Ω–µ None)
  - total_area (–Ω–µ 0)
  - address (–Ω–µ –ø—É—Å—Ç–æ–π)
- –°–æ–∑–¥–∞–Ω–∏–µ session_id

‚úÖ **–¢–µ—Å—Ç 4: –ü–æ–∏—Å–∫ –∞–Ω–∞–ª–æ–≥–æ–≤**
- POST /api/find-similar
- –ù–∞—Ö–æ–¥–∏—Ç—Å—è –º–∏–Ω–∏–º—É–º 3 –∞–Ω–∞–ª–æ–≥–∞
- –ê–Ω–∞–ª–æ–≥–∏ –∏–º–µ—é—Ç URL –∏ –¥–∞–Ω–Ω—ã–µ

‚úÖ **–¢–µ—Å—Ç 5: –ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞**
- POST /api/analyze
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –æ—Ç—á–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:
  - `fair_price_total` > 0
  - `market_statistics.median` > 0
  - `comparables.length` >= 3

‚úÖ **–¢–µ—Å—Ç 6: –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è**
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–æ—Ç–¥–µ–ª–∫–∞, –≤–∏–¥ –∏–∑ –æ–∫–Ω–∞)
- POST /api/update-target
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ü–µ–Ω–∞ **–∏–∑–º–µ–Ω–∏–ª–∞—Å—å**

‚úÖ **–¢–µ—Å—Ç 7: –®–∞—Ä–∏–Ω–≥ —Å–µ—Å—Å–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç**
- GET /wizard?session={id}
- Session ID –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (CI/CD)

### GitHub Actions

–ü—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ main/develop:

1. ‚úÖ **Unit —Ç–µ—Å—Ç—ã** - –±—ã—Å—Ç—Ä—ã–µ –º–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
2. ‚úÖ **Coverage check** - –º–∏–Ω–∏–º—É–º 60% –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞
3. ‚úÖ **Security —Ç–µ—Å—Ç—ã** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
4. ‚è© **Deploy** - —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏
5. ‚úÖ **E2E smoke tests** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ - HTML –æ—Ç—á–µ—Ç
pytest tests/ --html=test_reports/report.html --self-contained-html
open test_reports/report.html

# Coverage –æ—Ç—á–µ—Ç
pytest tests/ --cov=src --cov-report=html
open htmlcov/index.html

# GitHub Actions - –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
# –°–∫–∞—á–∏–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ run
```

## –ù–∞–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### Unit —Ç–µ—Å—Ç

```python
# tests/test_my_feature.py
import pytest

def test_my_feature():
    result = my_function()
    assert result == expected_value
```

### API —Ç–µ—Å—Ç

```python
def test_api_endpoint(client):
    response = client.post('/api/endpoint', json={'data': 'value'})

    assert response.status_code == 200
    data = response.json()
    assert data['status'] == 'success'
```

### E2E —Ç–µ—Å—Ç

```python
def test_user_flow():
    # 1. –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
    response = requests.get(f"{BASE_URL}/wizard")
    assert response.status_code == 200

    # 2. –ü–∞—Ä—Å–∏–º –æ–±—ä–µ–∫—Ç
    parse_response = requests.post(
        f"{BASE_URL}/api/parse-url",
        json={"url": TEST_URL}
    )
    session_id = parse_response.json()["session_id"]

    # 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    assert session_id is not None
```

## –û—Ç–ª–∞–¥–∫–∞ —É–ø–∞–≤—à–∏—Ö —Ç–µ—Å—Ç–æ–≤

### 1. –°–º–æ—Ç—Ä–∏–º –ø–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥

```bash
pytest tests/test_failing.py -v --tb=long -s
```

### 2. –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–æ–ª—å–∫–æ —É–ø–∞–≤—à–∏–π —Ç–µ—Å—Ç

```bash
pytest tests/test_failing.py::test_specific_test -v
```

### 3. –î–æ–±–∞–≤–ª—è–µ–º breakpoint

```python
def test_debug():
    result = my_function()
    import pdb; pdb.set_trace()  # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    assert result == expected
```

### 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
tail -f test_reports/pytest.log

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh root@server "tail -f /var/log/housler/app.log"
```

## –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- ‚úÖ –í—Å–µ –Ω–æ–≤—ã–µ features –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —Ç–µ—Å—Ç—ã
- ‚úÖ Coverage –º–∏–Ω–∏–º—É–º 60% (—Å—Ç—Ä–µ–º–∏–º—Å—è –∫ 80%)
- ‚úÖ E2E —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π
- ‚úÖ Security —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö input'–æ–≤

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤

| –¢–∏–ø —Ç–µ—Å—Ç–∞ | –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è | –ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å |
|-----------|------------------|-----------------|
| Unit      | ~10 —Å–µ–∫          | –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ |
| API       | ~30 —Å–µ–∫          | –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ |
| Security  | ~20 —Å–µ–∫          | –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ |
| E2E       | ~2-5 –º–∏–Ω         | –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º |

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
pytest tests/test_api.py::test_parse_url -v

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ –∏–º–µ–Ω–∏
pytest tests/ -k "parse" -v

# –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest tests/ -m "not slow" -v

# –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (–±—ã—Å—Ç—Ä–µ–µ)
pytest tests/ -n auto

# –° –ø–æ–¥—Ä–æ–±–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
pytest tests/ --log-cli-level=DEBUG -v
```

## Troubleshooting

### Redis –Ω–µ –∑–∞–ø—É—â–µ–Ω

```bash
# Mac
brew services start redis

# Linux
sudo systemctl start redis
```

### Playwright –±—Ä–∞—É–∑–µ—Ä –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

```bash
python -m playwright install chromium
```

### Port —É–∂–µ –∑–∞–Ω—è—Ç

```bash
# –£–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É 8001
lsof -ti:8001 | xargs kill -9
```

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Ç–µ—Å—Ç–∞–º–∏:
- –ü—Ä–æ–≤–µ—Ä—å TESTING.md (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
- –ó–∞–ø—É—Å—Ç–∏ `./scripts/run_full_test_suite.sh` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏: `cat test_reports/report_*.txt`
