# üöÄ –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é Housler

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
2. [–ß—Ç–æ –∫—É–¥–∞ –¥–µ–ø–ª–æ–∏—Ç—Å—è](#—á—Ç–æ-–∫—É–¥–∞-–¥–µ–ø–ª–æ–∏—Ç—Å—è)
3. [–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –Ω–∞ –ø—Ä–æ–¥–µ](#—Ç–µ–∫—É—â–∞—è-–ø—Ä–æ–±–ª–µ–º–∞)
4. [–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä—è—Ç—å](#–∫–∞–∫-–ø—Ä–æ–≤–µ—Ä—è—Ç—å)
5. [–ö–∞–∫ —á–∏–Ω–∏—Ç—å](#–∫–∞–∫-—á–∏–Ω–∏—Ç—å)
6. [–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è](#–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π-–¥–µ–ø–ª–æ–π)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –¢–µ–∫—É—â–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Housler

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    ‚Üì
[Cloudflare/DNS] ‚Üí housler.ru
    ‚Üì
[Yandex Cloud Application Load Balancer (Envoy)]
    ‚Üì
[Yandex Compute Instance: 91.229.8.221]
    ‚Üì
[Nginx] ‚Üí –ø–æ—Ä—Ç 80
    ‚Üì
[Flask App (Gunicorn)] ‚Üí –ø–æ—Ä—Ç 5000
    ‚Üì
[Redis] ‚Üí –ø–æ—Ä—Ç 6379 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **DNS/CDN**: Cloudflare –∏–ª–∏ –ø—Ä—è–º–æ–π DNS ‚Üí `housler.ru`
2. **Load Balancer**: Yandex Cloud ALB —Å Envoy proxy
3. **–°–µ—Ä–≤–µ—Ä**: Yandex Compute Instance (91.229.8.221)
4. **–í–µ–±-—Å–µ—Ä–≤–µ—Ä**: Nginx (–ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –Ω–∞ Flask)
5. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**: Flask + Gunicorn
6. **–ö—ç—à**: Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üì¶ –ß—Ç–æ –∫—É–¥–∞ –¥–µ–ø–ª–æ–∏—Ç—Å—è

### 1. GitHub ‚Üí Production Server

**–ü—Ä–æ—Ü–µ—Å—Å:**
```bash
# 1. –õ–æ–∫–∞–ª—å–Ω–æ: –∫–æ–º–º–∏—Ç –∏ –ø—É—à
git add .
git commit -m "feat: –Ω–æ–≤–∞—è —Ñ–∏—á–∞"
git push origin main  # –∏–ª–∏ –≤–∞—à–∞ –≤–µ—Ç–∫–∞

# 2. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ: –¥–µ–ø–ª–æ–π —Å–∫—Ä–∏–ø—Ç –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
bash scripts/deploy.sh
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ö–æ–¥ –ø—É—à–∏—Ç—Å—è –≤ GitHub
2. –°–∫—Ä–∏–ø—Ç `scripts/deploy.sh` –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ SSH –∫ —Å–µ—Ä–≤–µ—Ä—É
3. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–µ–ª–∞–µ—Ç—Å—è `git pull`
4. –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è requirements.txt)
5. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è systemd —Å–µ—Ä–≤–∏—Å `housler`

### 2. –ì–¥–µ —á—Ç–æ –ª–µ–∂–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```
/var/www/housler/              ‚Üê –ö–æ—Ä–Ω–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ app_new.py                 ‚Üê –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ requirements.txt           ‚Üê Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .env                       ‚Üê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ù–ï –≤ Git!)
‚îú‚îÄ‚îÄ venv/                      ‚Üê Virtual environment
‚îú‚îÄ‚îÄ src/                       ‚Üê –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ blog/                  ‚Üê –ú–æ–¥—É–ª—å –±–ª–æ–≥–∞ (–ù–û–í–û–ï!)
‚îÇ   ‚îú‚îÄ‚îÄ parsers/               ‚Üê –ü–∞—Ä—Å–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ models/                ‚Üê –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ analytics/             ‚Üê –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
‚îú‚îÄ‚îÄ templates/                 ‚Üê HTML —à–∞–±–ª–æ–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ blog/                  ‚Üê –®–∞–±–ª–æ–Ω—ã –±–ª–æ–≥–∞ (–ù–û–í–û–ï!)
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îî‚îÄ‚îÄ wizard.html
‚îú‚îÄ‚îÄ static/                    ‚Üê CSS, JS, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ css/blog.css          ‚Üê –°—Ç–∏–ª–∏ –±–ª–æ–≥–∞ (–ù–û–í–û–ï!)
‚îî‚îÄ‚îÄ data/                      ‚Üê –î–∞–Ω–Ω—ã–µ
    ‚îî‚îÄ‚îÄ blog_articles.json    ‚Üê –ë–∞–∑–∞ —Å—Ç–∞—Ç–µ–π –±–ª–æ–≥–∞ (–ù–û–í–û–ï!)
```

### 3. Systemd —Å–µ—Ä–≤–∏—Å

–§–∞–π–ª: `/etc/systemd/system/housler.service`

```ini
[Unit]
Description=Housler Flask Application
After=network.target

[Service]
Type=notify
User=www-data
WorkingDirectory=/var/www/housler
Environment="PATH=/var/www/housler/venv/bin"
ExecStart=/var/www/housler/venv/bin/gunicorn \
    --bind 127.0.0.1:5000 \
    --workers 4 \
    --timeout 300 \
    --access-logfile /var/log/housler/access.log \
    --error-logfile /var/log/housler/error.log \
    app_new:app

Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

**–ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å
sudo systemctl start housler

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
sudo systemctl stop housler

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
sudo systemctl restart housler

# –°—Ç–∞—Ç—É—Å
sudo systemctl status housler

# –õ–æ–≥–∏
sudo journalctl -u housler -f
```

---

## üî• –¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –Ω–∞ –ø—Ä–æ–¥–µ

### –°–∏–º–ø—Ç–æ–º—ã:
```bash
curl https://housler.ru/
# ‚Üí HTTP 403 Forbidden
# ‚Üí "Access denied"
```

**–í–°–ï** endpoints –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 403:
- `/` ‚Üí 403
- `/health` ‚Üí 403
- `/calculator` ‚Üí 403
- `/blog` ‚Üí 403 (–Ω–æ–≤—ã–π endpoint)

### –ü—Ä–∏—á–∏–Ω–∞:

**–ù–ï –ø—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–¥–æ–º!** –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ **Yandex Cloud Load Balancer (Envoy)**.

–û—Ç–≤–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –æ—Ç `server: envoy`, –∞ –Ω–µ –æ—Ç –≤–∞—à–µ–≥–æ Nginx ‚Üí –∑–Ω–∞—á–∏—Ç –∑–∞–ø—Ä–æ—Å –¥–∞–∂–µ –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ —Å–µ—Ä–≤–µ—Ä–∞.

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:

#### 1. **Security Group –≤ Yandex Cloud**

Load Balancer –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å Security Group, –∫–æ—Ç–æ—Ä–∞—è –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫.

**–ì–¥–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```
Yandex Cloud Console
‚Üí Application Load Balancer
‚Üí –í–∞—à –±–∞–ª–∞–Ω—Å–µ—Ä
‚Üí Security Groups
‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ Ingress (–≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫)
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–æ:**
- HTTP (80) from 0.0.0.0/0
- HTTPS (443) from 0.0.0.0/0

#### 2. **Backend Group –Ω–µ –≤–∏–¥–∏—Ç —Å–µ—Ä–≤–µ—Ä**

–ë–∞–ª–∞–Ω—Å–µ—Ä –º–æ–∂–µ—Ç –¥—É–º–∞—Ç—å —á—Ç–æ backend (–≤–∞—à —Å–µ—Ä–≤–µ—Ä) –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

**–ì–¥–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```
Yandex Cloud Console
‚Üí Application Load Balancer
‚Üí Backend Groups
‚Üí –í–∞—à–∞ –≥—Ä—É–ø–ø–∞
‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Health Check —Å—Ç–∞—Ç—É—Å
```

**Health Check –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:**
- Type: HTTP
- Path: `/health`
- Port: 80 (–∏–ª–∏ 5000 –µ—Å–ª–∏ –Ω–∞–ø—Ä—è–º—É—é)
- Interval: 10s
- Timeout: 5s
- Healthy threshold: 2
- Unhealthy threshold: 2

#### 3. **HTTP Router –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω**

**–ì–¥–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```
Yandex Cloud Console
‚Üí Application Load Balancer
‚Üí HTTP Routers
‚Üí –í–∞—à —Ä–æ—É—Ç–µ—Ä
‚Üí Virtual Hosts
‚Üí Routes
```

**–î–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Ä—à—Ä—É—Ç:**
```
Path: /
Backend Group: –≤–∞—à–∞_–≥—Ä—É–ø–ø–∞
Timeout: 300s
```

#### 4. **Listener —Å–ª—É—à–∞–µ—Ç –Ω–µ —Ç–æ—Ç –ø–æ—Ä—Ç/–ø—Ä–æ—Ç–æ–∫–æ–ª**

**–ì–¥–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```
Yandex Cloud Console
‚Üí Application Load Balancer
‚Üí –í–∞—à –±–∞–ª–∞–Ω—Å–µ—Ä
‚Üí Listeners
```

**–î–æ–ª–∂–Ω—ã –±—ã—Ç—å:**
- HTTP Listener: 0.0.0.0:80 ‚Üí –≤–∞—à HTTP Router
- HTTPS Listener: 0.0.0.0:443 ‚Üí –≤–∞—à HTTP Router (–µ—Å–ª–∏ SSL –Ω–∞—Å—Ç—Ä–æ–µ–Ω)

---

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä—è—Ç—å

### 1. –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç (–ª–æ–∫–∞–ª—å–Ω–æ)

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
bash scripts/diagnose.sh

# –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
# - HTTP —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö endpoints
# - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–∫—Å–∏/CDN
# - DNS –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
# - –ü–æ–ø—ã—Ç–∫–∏ –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–∞–º–æ–º —Å–µ—Ä–≤–µ—Ä–µ (–Ω—É–∂–µ–Ω SSH)

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É:**
```bash
ssh root@91.229.8.221
# –ò–ª–∏ —Å –∫–ª—é—á–æ–º:
ssh -i ~/.ssh/id_housler root@91.229.8.221
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

#### a) –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
```bash
systemctl status housler
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å: active (running)
```

#### b) –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—á–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ?
```bash
curl http://localhost:5000/health
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: {"status": "healthy", ...}
```

#### c) Nginx —Ä–∞–±–æ—Ç–∞–µ—Ç?
```bash
systemctl status nginx
nginx -t  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

#### d) –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Nginx
```bash
curl http://localhost/health
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: {"status": "healthy", ...}
```

#### e) –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫
journalctl -u housler -n 50 --no-pager

# –í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
journalctl -u housler -f

# –§–∞–π–ª–æ–≤—ã–µ –ª–æ–≥–∏
tail -f /var/log/housler/error.log
tail -f /var/log/housler/access.log
```

#### f) –õ–æ–≥–∏ Nginx
```bash
tail -f /var/log/nginx/error.log
tail -f /var/log/nginx/access.log
```

#### g) –ü–æ—Ä—Ç—ã —Å–ª—É—à–∞—é—Ç—Å—è?
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ 5000 —Å–ª—É—à–∞–µ—Ç—Å—è
netstat -tlnp | grep 5000
# –ò–ª–∏
ss -tlnp | grep 5000

# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: gunicorn —Å–ª—É—à–∞–µ—Ç 127.0.0.1:5000
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Yandex Cloud (–Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Å–æ–ª–∏)

**–®–∞–≥ 1: Application Load Balancer**
```
1. –û—Ç–∫—Ä–æ–π—Ç–µ Yandex Cloud Console
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Application Load Balancer
3. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à –±–∞–ª–∞–Ω—Å–µ—Ä

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
‚úì –°—Ç–∞—Ç—É—Å: Active
‚úì Listeners: HTTP (80), HTTPS (443)
‚úì Backend Group: Attached
‚úì Health Check: Healthy
```

**–®–∞–≥ 2: Backend Group**
```
1. –û—Ç–∫—Ä–æ–π—Ç–µ Backend Groups
2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à—É –≥—Ä—É–ø–ø—É

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
‚úì Targets: 91.229.8.221
‚úì Health Check: Path /health, Port 80
‚úì Status: Healthy (–∑–µ–ª–µ–Ω–∞—è –≥–∞–ª–æ—á–∫–∞)

–ï—Å–ª–∏ Status: Unhealthy (–∫—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫):
  ‚Üí Backend –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –±–∞–ª–∞–Ω—Å–µ—Ä–∞
  ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Security Groups
  ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```

**–®–∞–≥ 3: Security Groups**
```
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ VPC ‚Üí Security Groups
2. –ù–∞–π–¥–∏—Ç–µ –≥—Ä—É–ø–ø—É –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—É—é –∫ –±–∞–ª–∞–Ω—Å–µ—Ä—É

Ingress Rules (–≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫):
‚úì Protocol: TCP
‚úì Port: 80 (HTTP)
‚úì Source: 0.0.0.0/0
‚úì Action: Allow

‚úì Protocol: TCP
‚úì Port: 443 (HTTPS)
‚úì Source: 0.0.0.0/0
‚úì Action: Allow

Egress Rules (–∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫):
‚úì Protocol: Any
‚úì Destination: 0.0.0.0/0
‚úì Action: Allow
```

**–®–∞–≥ 4: HTTP Router**
```
1. –û—Ç–∫—Ä–æ–π—Ç–µ HTTP Routers
2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à —Ä–æ—É—Ç–µ—Ä

Virtual Hosts:
‚úì Authority: housler.ru, www.housler.ru
‚úì Routes:
   - Path: /
   - Backend Group: –≤–∞—à–∞_–≥—Ä—É–ø–ø–∞
   - Timeout: 300s
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å A-–∑–∞–ø–∏—Å—å
dig housler.ru A

# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å IP –±–∞–ª–∞–Ω—Å–µ—Ä–∞ –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞
# –ï—Å–ª–∏ IP –±–∞–ª–∞–Ω—Å–µ—Ä–∞ ‚Üí —Ç—Ä–∞—Ñ–∏–∫ –∏–¥–µ—Ç —á–µ—Ä–µ–∑ ALB
# –ï—Å–ª–∏ IP —Å–µ—Ä–≤–µ—Ä–∞ (91.229.8.221) ‚Üí —Ç—Ä–∞—Ñ–∏–∫ –∏–¥–µ—Ç –Ω–∞–ø—Ä—è–º—É—é
```

### 5. –û–±—Ö–æ–¥ –±–∞–ª–∞–Ω—Å–µ—Ä–∞ (–¥–ª—è —Ç–µ—Å—Ç–∞)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–∏–Ω—É—è –±–∞–ª–∞–Ω—Å–µ—Ä:

```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ /etc/hosts (–≤—Ä–µ–º–µ–Ω–Ω–æ)
echo "91.229.8.221 housler.ru" | sudo tee -a /etc/hosts

# –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—å—Ç–µ
curl http://housler.ru/health

# –ù–µ –∑–∞–±—É–¥—å—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ—Ç–æ–º:
sudo sed -i '/91.229.8.221 housler.ru/d' /etc/hosts
```

---

## üõ†Ô∏è –ö–∞–∫ —á–∏–Ω–∏—Ç—å

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: Backend Unhealthy –≤ Yandex Cloud

**–ü—Ä–æ–±–ª–µ–º–∞:** Backend Group –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫—Ä–∞—Å–Ω—ã–π —Å—Ç–∞—Ç—É—Å.

**–†–µ—à–µ–Ω–∏–µ:**

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Security Group backend'–∞ (—Å–µ—Ä–≤–µ—Ä–∞):**
   ```
   VPC ‚Üí Security Groups ‚Üí –ì—Ä—É–ø–ø–∞ —Å–µ—Ä–≤–µ—Ä–∞

   Ingress Rules –¥–æ–ª–∂–Ω—ã —Ä–∞–∑—Ä–µ—à–∞—Ç—å:
   - Port 80 from Load Balancer Subnet
   - Port 22 from 0.0.0.0/0 (–¥–ª—è SSH)
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Health Check –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
   ```
   Backend Groups ‚Üí –í–∞—à–∞ –≥—Ä—É–ø–ø–∞ ‚Üí Health Check

   –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   - Type: HTTP
   - Path: /health
   - Port: 80
   - Interval: 10
   - Timeout: 5
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ /health:**
   ```bash
   ssh root@91.229.8.221
   curl http://localhost/health
   ```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: Security Group –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã 403, –±–∞–ª–∞–Ω—Å–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç—Ä–∞—Ñ–∏–∫.

**–†–µ—à–µ–Ω–∏–µ:**

```
1. Yandex Cloud Console
2. Application Load Balancer ‚Üí –í–∞—à –±–∞–ª–∞–Ω—Å–µ—Ä
3. Network Settings ‚Üí Security Groups
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –µ—Å—Ç—å –ø—Ä–∞–≤–∏–ª–∞:
   - TCP 80 from 0.0.0.0/0 ALLOW
   - TCP 443 from 0.0.0.0/0 ALLOW
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–ø–∞–ª–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –∫—Ä–∞—à–∏—Ç—Å—è.

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh root@91.229.8.221

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
systemctl status housler

# –ï—Å–ª–∏ inactive –∏–ª–∏ failed:
systemctl restart housler

# –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
journalctl -u housler -f

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏ Python
tail -f /var/log/housler/error.log
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ù–æ–≤—ã–π –∫–æ–¥ —Å–ª–æ–º–∞–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è.

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh root@91.229.8.221

# –û—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–º–º–∏—Ç
cd /var/www/housler
git log --oneline -5  # –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–º–º–∏—Ç—ã
git checkout <–ø—Ä–µ–¥—ã–¥—É—â–∏–π_–∫–æ–º–º–∏—Ç>

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
systemctl restart housler

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
curl http://localhost:5000/health
```

**–ò–ª–∏ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å:**

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
git revert HEAD  # –û—Ç–∫–∞—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–º–º–∏—Ç–∞
git push origin main

# –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å
bash scripts/deploy.sh
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: Cloudflare –±–ª–æ–∫–∏—Ä—É–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Cloudflare –∏ –æ–Ω –≤ —Ä–µ–∂–∏–º–µ "Under Attack".

**–†–µ—à–µ–Ω–∏–µ:**

```
1. –ó–∞–π—Ç–∏ –≤ Cloudflare Dashboard
2. Security ‚Üí Settings
3. Security Level: –û—Ç–∫–ª—é—á–∏—Ç—å "Under Attack Mode"
4. –ü–æ—Å—Ç–∞–≤–∏—Ç—å "Medium" –∏–ª–∏ "Low"
```

---

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ ‚Üí Production

#### –®–∞–≥ 1: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É
git checkout -b feature/new-feature

# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
# ... –∫–æ–¥ ...

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ
python app_new.py
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å http://localhost:5000

# –ö–æ–º–º–∏—Ç
git add .
git commit -m "feat: –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ñ–∏—á—É"

# Push
git push origin feature/new-feature
```

#### –®–∞–≥ 2: –ö–æ–¥-—Ä–µ–≤—å—é –∏ –º–µ—Ä–∂

```bash
# –°–æ–∑–¥–∞—Ç—å Pull Request –Ω–∞ GitHub
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –æ–±—Å—É–¥–∏—Ç—å

# –°–º–µ—Ä–∂–∏—Ç—å –≤ main
git checkout main
git merge feature/new-feature
git push origin main
```

#### –®–∞–≥ 3: –î–µ–ø–ª–æ–π –Ω–∞ production

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (—á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç):**

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—ã –Ω–∞ main –≤–µ—Ç–∫–µ
git checkout main

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π
bash scripts/deploy.sh

# –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
# 2. Push –≤ GitHub
# 3. Pull –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
# 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
# 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
# 7. –ü–æ–∫–∞–∑ –ª–æ–≥–æ–≤
```

**–†—É—á–Ω–æ–π (–µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç):**

```bash
# 1. SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh root@91.229.8.221

# 2. –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd /var/www/housler

# 3. Pull –∏–∑–º–µ–Ω–µ–Ω–∏–π
git pull origin main

# 4. –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
source venv/bin/activate
pip install -r requirements.txt

# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
systemctl restart housler

# 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
systemctl status housler
curl http://localhost:5000/health
```

#### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

```bash
# 1. –õ–æ–∫–∞–ª—å–Ω–æ - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
curl https://housler.ru/health

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ endpoints
curl https://housler.ru/
curl https://housler.ru/calculator
curl https://housler.ru/blog  # –ù–û–í–û–ï!

# 3. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
bash scripts/diagnose.sh

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh root@91.229.8.221 'journalctl -u housler -n 50'
```

---

## üéØ –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
bash scripts/diagnose.sh

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ - —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
ssh root@91.229.8.221 'systemctl status housler'

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ - –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏
ssh root@91.229.8.221 'journalctl -u housler -n 50 --no-pager'

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ
ssh root@91.229.8.221 'curl -s http://localhost:5000/health | jq'
```

### –î–µ–ø–ª–æ–π

```bash
# –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π
bash scripts/deploy.sh

# –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh root@91.229.8.221 'cd /var/www/housler && git pull && systemctl restart housler'
```

### –û—Ç–∫–∞—Ç

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh root@91.229.8.221 'cd /var/www/housler && git checkout HEAD~1 && systemctl restart housler'

# –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
git revert HEAD
git push origin main
bash scripts/deploy.sh
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
ssh root@91.229.8.221 'systemctl restart housler'

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å nginx
ssh root@91.229.8.221 'systemctl restart nginx'

# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (–∫—Ä–∞–π–Ω–∏–π —Å–ª—É—á–∞–π!)
ssh root@91.229.8.221 'reboot'
```

---

## üìû –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç —á–µ–∫-–ª–∏—Å—Ç –∫–æ–≥–¥–∞ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

```
‚ñ° –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É: bash scripts/diagnose.sh
‚ñ° –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–∞–π—Ç –æ—Ç–≤–µ—á–∞–µ—Ç: curl https://housler.ru/health
‚ñ° –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTP –∫–æ–¥: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 200, –Ω–µ 403/500/502

–ï—Å–ª–∏ 403 (Access Denied):
  ‚ñ° –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Yandex Cloud ‚Üí ALB ‚Üí Security Groups
  ‚ñ° –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Backend Group ‚Üí Health Check —Å—Ç–∞—Ç—É—Å
  ‚ñ° –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTP Router ‚Üí Routes

–ï—Å–ª–∏ 500 (Internal Server Error):
  ‚ñ° SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä
  ‚ñ° –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: journalctl -u housler -f
  ‚ñ° –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Python –æ—à–∏–±–∫–∏ –≤ /var/log/housler/error.log

–ï—Å–ª–∏ 502 (Bad Gateway):
  ‚ñ° –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ
  ‚ñ° systemctl status housler
  ‚ñ° systemctl restart housler

–ï—Å–ª–∏ —Å–∞–π—Ç –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤–æ–æ–±—â–µ:
  ‚ñ° –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DNS: dig housler.ru
  ‚ñ° –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω: ping 91.229.8.221
  ‚ñ° –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSH —Ä–∞–±–æ—Ç–∞–µ—Ç: ssh root@91.229.8.221
```

---

## üéì –ò—Ç–æ–≥–æ

### –ì–¥–µ —á—Ç–æ –ª–µ–∂–∏—Ç:
- **–ö–æ–¥**: GitHub ‚Üí `/var/www/housler` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**: Gunicorn –Ω–∞ –ø–æ—Ä—Ç—É 5000
- **–í–µ–±-—Å–µ—Ä–≤–µ—Ä**: Nginx –Ω–∞ –ø–æ—Ä—Ç—É 80
- **–ë–∞–ª–∞–Ω—Å–µ—Ä**: Yandex Cloud ALB
- **DNS**: housler.ru ‚Üí IP –±–∞–ª–∞–Ω—Å–µ—Ä–∞ –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞

### –ö–∞–∫ –¥–µ–ø–ª–æ–∏—Ç—å:
1. `git commit && git push`
2. `bash scripts/deploy.sh`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `curl https://housler.ru/health`

### –ö–∞–∫ —á–∏–Ω–∏—Ç—å:
1. `bash scripts/diagnose.sh` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Yandex Cloud ‚Üí ALB ‚Üí Security Groups
3. SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
4. –û—Ç–∫–∞—Ç–∏—Ç—å—Å—è –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

### –¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:
- **–ß—Ç–æ**: HTTP 403 –Ω–∞ –≤—Å–µ—Ö endpoints
- **–ì–¥–µ**: Yandex Cloud ALB (Envoy proxy)
- **–ü–æ—á–µ–º—É**: Security Group –∏–ª–∏ Backend Group
- **–ö–∞–∫ —á–∏–Ω–∏—Ç—å**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Yandex Cloud Console

---

**–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?** –ó–∞–ø—É—Å—Ç–∏—Ç–µ `bash scripts/diagnose.sh` –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –≤—ã–≤–æ–¥!
