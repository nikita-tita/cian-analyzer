# Исправление системы коэффициентов

## Проблема
Справедливая цена постоянно занижается на 20-30% из-за неадекватных коэффициентов и учета нерелевантных параметров.

## Что исправлено

### 1. ✅ Коэффициенты ремонта (КРИТИЧНО)

**БЫЛО:**
```python
'черновая': 0.80
'стандартная': 1.00
'улучшенная': 1.03    # +3%
'премиум': 1.08       # +8%
'люкс': 1.12          # +12%
```

**СТАЛО:**
```python
'черновая': 0.75      # -25% (затраты на ремонт)
'эконом': 0.85        # 18-25k за м²
'стандартная': 1.00   # 25-40k за м² (база)
'капитальная': 1.15   # 30-52k за м² (+15%)
'улучшенная': 1.25    # ~60k за м² (+25%)
'премиум': 1.50       # 52-80k за м² (+50%)
'люкс': 1.80          # 80-100k за м² (+80%)
'дизайнерская': 2.00  # 100k+ за м² (+100%)
```

**Обоснование:** Реальная стоимость ремонта влияет на цену за м² согласно таблице:
- Эконом: 18-25k за м²
- Стандарт: 25-40k за м² (+51% к эконому)
- Капитальный: 30-52k за м² (+90% к эконому)
- Элит/Дизайнер: 52-100k+ за м² (+253% к эконому)

### 2. ✅ Коэффициенты вида из окна

**БЫЛО:**
```python
'вода': 1.07    # +7%
'парк': 1.03    # +3%
```

**СТАЛО:**
```python
'худогов': 0.97     # -3%
'дом': 1.00         # база
'улица': 1.00       # база
'парк': 1.03        # +3%
'вода': 1.05        # +5% (МАКСИМУМ!)
'город': 1.04       # +4%
'закат': 1.05       # +5%
'премиум': 1.05     # +5% макс
```

**Обоснование:** Вид из окна влияет максимум на 5%, не более.

### 3. ❌ УДАЛЕНЫ нерелевантные параметры

#### Расстояние до метро
- **Причина:** Все аналоги в одной области, одинаковое расстояние
- **Файлы:** `coefficients.py`, `fair_price_calculator.py`, `parameter_classifier.py`

#### Уровень шума
- **Причина:** Сравнение в одной области
- **Файлы:** `coefficients.py`, `fair_price_calculator.py`, `parameter_classifier.py`

#### Людность
- **Причина:** Не учитывается в оценке
- **Файлы:** `coefficients.py`, `fair_price_calculator.py`, `parameter_classifier.py`

#### Количество машиномест
- **Причина:** Не имеет смысла без контекста (сколько всего людей?)
- **Тип парковки** остался в ФИКСИРОВАННЫХ параметрах
- **Файлы:** `coefficients.py`, `fair_price_calculator.py`, `parameter_classifier.py`

## Результат

### Переменные параметры (СОКРАЩЕНО с 16 до 12):
1. ✅ `repair_level` - **УСИЛЕНО** (теперь +50% до +100%)
2. ✅ `ceiling_height` - высота потолков
3. ✅ `bathrooms` - ванные комнаты
4. ✅ `window_type` - тип окон
5. ✅ `elevator_count` - лифты
6. ✅ `living_area` - жилая площадь (%)
7. ✅ `total_area` - общая площадь
8. ✅ `floor` - этаж
9. ✅ `view_type` - **ОСЛАБЛЕНО** (теперь макс +5%)
10. ✅ `photo_type` - тип фото
11. ✅ `object_status` - статус объекта
12. ✅ `build_year` - возраст дома

### Удалены (4 параметра):
- ❌ `metro_distance_min` - одна область
- ❌ `noise_level` - одна область
- ❌ `crowded_level` - не учитывается
- ❌ `parking_spaces` - нет контекста

## Измененные файлы

1. `/src/analytics/coefficients.py`
   - Обновлены коэффициенты ремонта
   - Обновлены коэффициенты вида
   - Удалены функции: `get_metro_distance_coefficient()`, `get_parking_spaces_bonus()`
   - Удалены словари: `NOISE_LEVEL_COEFFICIENTS`, `CROWDED_LEVEL_COEFFICIENTS`

2. `/src/analytics/fair_price_calculator.py`
   - Убраны импорты удаленных коэффициентов
   - Удалена логика применения: метро, шум, людность, машиномест

3. `/src/analytics/parameter_classifier.py`
   - Обновлен `VARIABLE_PARAMETERS`: удалено 4 параметра
   - Обновлены группы параметров
   - Обновлены примеры в документации

## Ожидаемый эффект

**ДО:** Справедливая цена на 20-30% ниже рыночной

**ПОСЛЕ:**
- Ремонт теперь адекватно влияет на цену (+50-100% для премиум/люкс)
- Вид ослаблен до реалистичных 5%
- Удалены "шумовые" параметры, которые искажали расчет
- Справедливая цена должна быть ближе к реальной рыночной

## Тестирование

Запустите на реальных данных и проверьте:
1. Справедливая цена теперь ближе к рыночной (±10%)
2. Премиум отделка дает существенный бонус (+50-100%)
3. Вид дает небольшой бонус (до +5%)
4. Удаленные параметры больше не искажают результат

## Дата
2025-11-06
