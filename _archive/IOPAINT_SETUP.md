# üé® –ù–∞—Å—Ç—Ä–æ–π–∫–∞ IOPaint –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤

## –ß—Ç–æ —Ç–∞–∫–æ–µ IOPaint?

IOPaint - —ç—Ç–æ AI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è inpainting (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π), –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –º–æ–¥–µ–ª—å LaMa.
**–ö–∞—á–µ—Å—Ç–≤–æ —É–¥–∞–ª–µ–Ω–∏—è –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (–≥–æ—Ä–∞–∑–¥–æ –ª—É—á—à–µ OpenCV)

## üìã –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ IOPaint

–û—Ç–∫—Ä–æ–π—Ç–µ **–ù–û–í–´–ô —Ç–µ—Ä–º–∏–Ω–∞–ª** (–æ—Ç–¥–µ–ª—å–Ω—ã–π –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è):

```bash
# –°–æ–∑–¥–∞–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å Python 3.11
conda create -n iopaint python=3.11 -y

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º
conda activate iopaint

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º IOPaint
pip install iopaint
```

**–í—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏:** ~2-3 –º–∏–Ω—É—Ç—ã

## üöÄ –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ IOPaint —Å–µ—Ä–≤–µ—Ä–∞

–í —Ç–æ–º –∂–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```bash
iopaint start --model=lama --port=8080 --device=cpu
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç:**
1. IOPaint —Å–∫–∞—á–∞–µ—Ç –º–æ–¥–µ–ª—å LaMa (~100MB) - —ç—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –æ–¥–∏–Ω —Ä–∞–∑
2. –ó–∞–ø—É—Å—Ç–∏—Ç—Å—è —Å–µ—Ä–≤–µ—Ä –Ω–∞ `http://127.0.0.1:8080`
3. –í—ã —É–≤–∏–¥–∏—Ç–µ:
   ```
   INFO:     Uvicorn running on http://127.0.0.1:8080
   INFO:     Application startup complete.
   ```

**–û—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª –æ—Ç–∫—Ä—ã—Ç—ã–º!** IOPaint –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ñ–æ–Ω–µ.

## üîç –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

–í **–¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ** (–æ—Å–Ω–æ–≤–Ω–æ–º):

```bash
cd /Users/fatbookpro/Desktop/cian
source venv/bin/activate
python src/iopaint_client.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üß™ –¢–ï–°–¢ IOPAINT CLIENT
‚úÖ IOPaint —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω
üì• –ó–∞–≥—Ä—É–∂–∞–µ–º: https://images.cdn-cian.ru/images/...
‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: test_images/iopaint_cleaned.jpg
```

–û—Ç–∫—Ä–æ–π—Ç–µ `test_images/iopaint_cleaned.jpg` - –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–¥–∞–ª–µ–Ω –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ!

## üåê –®–∞–≥ 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

–¢–µ–ø–µ—Ä—å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å IOPaint –µ—Å–ª–∏ –æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω!

```bash
# –í –æ—Å–Ω–æ–≤–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
cd /Users/fatbookpro/Desktop/cian/webapp
source ../venv/bin/activate
python app_cian_style.py
```

–û—Ç–∫—Ä–æ–π—Ç–µ: http://127.0.0.1:5002

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –í—ã –ø–∞—Ä—Å–∏—Ç–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
2. –ù–∞–∂–∏–º–∞–µ—Ç–µ "üßπ –°–∫–∞—á–∞—Ç—å —Å —É–¥–∞–ª–µ–Ω–∏–µ–º –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤"
3. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ IOPaint?
   - **–ï—Å–ª–∏ –î–ê** ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç IOPaint (–∫–∞—á–µ—Å—Ç–≤–æ ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê)
   - **–ï—Å–ª–∏ –ù–ï–¢** ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OpenCV (–∫–∞—á–µ—Å—Ç–≤–æ ‚≠ê‚≠ê)

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

| –ú–µ—Ç–æ–¥ | –ö–∞—á–µ—Å—Ç–≤–æ | –°–∫–æ—Ä–æ—Å—Ç—å | –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è |
|-------|----------|----------|------------|
| **IOPaint (LaMa)** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –û—Ç–ª–∏—á–Ω–æ | ~3-5 —Å–µ–∫/—Ñ–æ—Ç–æ | IOPaint —Å–µ—Ä–≤–µ—Ä |
| **OpenCV** | ‚≠ê‚≠ê –ß–∞—Å—Ç–∏—á–Ω–æ | ~2 —Å–µ–∫/—Ñ–æ—Ç–æ | –ù–µ—Ç |

**IOPaint —É–¥–∞–ª—è–µ—Ç:**
- ‚úÖ –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ç–µ–∫—Å—Ç "cian.ru" (100%)
- ‚úÖ –õ–æ–≥–æ—Ç–∏–ø—ã –≤ —É–≥–ª–∞—Ö (100%)
- ‚úÖ –ù–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ (100%)
- ‚úÖ –õ—é–±—ã–µ –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏ (100%)

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ IOPaint

### –ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ/—Å–∫–æ—Ä–æ—Å—Ç—å

–í [src/iopaint_client.py](src/iopaint_client.py:58):
```python
data = {
    'ldmSteps': 25,  # 10-50, –±–æ–ª—å—à–µ = –ª—É—á—à–µ –∫–∞—á–µ—Å—Ç–≤–æ, –º–µ–¥–ª–µ–Ω–Ω–µ–µ
}
```

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
- `ldmSteps: 15` - –±—ã—Å—Ç—Ä–æ, —Ö–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ
- `ldmSteps: 25` - –±–∞–ª–∞–Ω—Å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `ldmSteps: 50` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –º–µ–¥–ª–µ–Ω–Ω–æ

### –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ –º–∞—Å–∫–∏

–í [webapp/app_cian_style.py](webapp/app_cian_style.py:172):
```python
cleaned_img = remover.process_url(
    url=photo_info['url'],
    coverage_percent=25  # 10-50%, —Å–∫–æ–ª—å–∫–æ –Ω–∏–∂–Ω–µ–π —á–∞—Å—Ç–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å
)
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### IOPaint –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** `ERROR: Could not find a version...`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Python 3.11
conda activate iopaint
python --version  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 3.11.x

# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ
pip install --upgrade iopaint
```

### –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏–ª—Å—è, –Ω–æ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** `IOPaint –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
curl http://127.0.0.1:8080/api/v1/model

# –ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
open http://127.0.0.1:8080
```

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç >10 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Ñ–æ—Ç–æ

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–º–µ–Ω—å—à–∏—Ç–µ ldmSteps –≤ src/iopaint_client.py
# –ò–∑–º–µ–Ω–∏—Ç–µ 25 –Ω–∞ 15
```

### "Out of memory" –æ—à–∏–±–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –ø–∞–º—è—Ç–∏

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ IOPaint —Å –º–µ–Ω—å—à–∏–º —Ä–∞–∑–º–µ—Ä–æ–º
iopaint start --model=lama --port=8080 --device=cpu --quality=90
```

## üìù –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å IOPaint

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —Å IOPaint –Ω–∞–∂–º–∏—Ç–µ `Ctrl+C`

### –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å IOPaint

```bash
conda activate iopaint
iopaint start --model=lama --port=8080 --device=cpu
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å

```bash
curl http://127.0.0.1:8080/api/v1/model
```

### –ó–∞–ø—É—Å—Ç–∏—Ç—å IOPaint –≤ —Ñ–æ–Ω–µ (–Ω–∞ Mac/Linux)

```bash
conda activate iopaint
nohup iopaint start --model=lama --port=8080 &
```

## üéØ Workflow —Å IOPaint

**–ò–¥–µ–∞–ª—å–Ω—ã–π workflow:**

1. **–û–¥–∏–Ω —Ä–∞–∑ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:**
   ```bash
   conda create -n iopaint python=3.11 -y
   conda activate iopaint
   pip install iopaint
   ```

2. **–ö–∞–∂–¥—ã–π —Ä–∞–∑ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º:**
   ```bash
   # –¢–µ—Ä–º–∏–Ω–∞–ª 1: IOPaint
   conda activate iopaint
   iopaint start --model=lama --port=8080
   ```

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   ```bash
   # –¢–µ—Ä–º–∏–Ω–∞–ª 2: –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   cd /Users/fatbookpro/Desktop/cian/webapp
   source ../venv/bin/activate
   python app_cian_style.py
   ```

4. **–ü–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã:**
   - –¢–µ—Ä–º–∏–Ω–∞–ª 1: `Ctrl+C` (–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å IOPaint)
   - –¢–µ—Ä–º–∏–Ω–∞–ª 2: `Ctrl+C` (–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **IOPaint GitHub:** https://github.com/Sanster/IOPaint
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://www.iopaint.com/
- **–ú–æ–¥–µ–ª–∏:** LaMa, LDM, ZITS, MAT, FcF

## üÜö –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å OpenCV (–¥–æ/–ø–æ—Å–ª–µ)

**–ë–µ–∑ IOPaint (OpenCV):**
- –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Å—Ç–∞–µ—Ç—Å—è –≤–∏–¥–∏–º—ã–º
- –õ–æ–≥–æ—Ç–∏–ø—ã —Ä–∞–∑–º—ã—Ç—ã
- –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –≤ —É–≥–ª–∞—Ö

**–° IOPaint (LaMa):**
- –¢–µ–∫—Å—Ç —É–¥–∞–ª–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é
- –§–æ–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ
- –ù–∏–∫–∞–∫–∏—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

---

**–°–æ–∑–¥–∞–Ω–æ:** 2025-11-04
**–ê–≤—Ç–æ—Ä:** Claude Code
**–í–µ—Ä—Å–∏—è:** 1.0
