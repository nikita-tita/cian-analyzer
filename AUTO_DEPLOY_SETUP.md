# üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –Ω–∞ Housler.ru

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ü—Ä–∏ –∫–∞–∂–¥–æ–º `git push` –≤ –≤–µ—Ç–∫—É `main` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è GitHub Actions workflow (`.github/workflows/auto-deploy.yml`), –∫–æ—Ç–æ—Ä—ã–π:

### 1Ô∏è‚É£ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Job: `test`)
```yaml
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Python 3.11
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Redis
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ requirements.txt
- –ó–∞–ø—É—Å–∫–∞–µ—Ç Playwright
- –ü—Ä–æ–≥–æ–Ω—è–µ—Ç –≤—Å–µ —Ç–µ—Å—Ç—ã (pytest)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç code coverage
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç code quality (flake8, black)
```

### 2Ô∏è‚É£ –°–±–æ—Ä–∫–∞ (Job: `build`)
```yaml
- –°–æ–±–∏—Ä–∞–µ—Ç Docker image
- –¢–µ–≥–∏—Ä—É–µ—Ç –∫–∞–∫ housler-app:latest
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Å–æ–±—Ä–∞–Ω–Ω—ã–π image
```

### 3Ô∏è‚É£ –î–µ–ø–ª–æ–π (Job: `deploy`)
**–¢–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–µ—Å—Ç—ã –∏ —Å–±–æ—Ä–∫–∞ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!**

```yaml
- –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH
- –î–µ–ª–∞–µ—Ç git pull origin main
- –ó–∞–ø—É—Å–∫–∞–µ—Ç scripts/auto-deploy.sh
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç health check
- –£–≤–µ–¥–æ–º–ª—è–µ—Ç –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
```

### 4Ô∏è‚É£ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (Job: `notify`)
```yaml
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –¥–µ–ø–ª–æ—è
- –°–æ–∑–¥–∞–µ—Ç summary –Ω–∞ GitHub
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH —Å–µ–∫—Ä–µ—Ç–æ–≤

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å SSH private key

–ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:

```bash
# –ï—Å–ª–∏ —É –≤–∞—Å –£–ñ–ï –µ—Å—Ç—å SSH –∫–ª—é—á –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞
cat ~/.ssh/id_rsa
# –∏–ª–∏
cat ~/.ssh/id_ed25519

# –ï—Å–ª–∏ –ù–ï–¢ –∫–ª—é—á–∞ - —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π
ssh-keygen -t ed25519 -C "github-actions-housler"
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ ~/.ssh/id_housler_deploy
# –ù–ï –≤–≤–æ–¥–∏—Ç–µ passphrase (–ø—Ä–æ—Å—Ç–æ Enter)
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –í–ï–°–¨ –≤—ã–≤–æ–¥ (–≤–∫–ª—é—á–∞—è `-----BEGIN` –∏ `-----END`)

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
cat ~/.ssh/id_housler_deploy.pub

# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@91.229.8.221

# –î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á –≤ authorized_keys
echo "–í–ê–®_–ü–£–ë–õ–ò–ß–ù–´–ô_–ö–õ–Æ–ß" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
exit
```

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: https://github.com/nikita-tita/cian-analyzer
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**
3. –ù–∞–∂–º–∏—Ç–µ **New repository secret**
4. –î–æ–±–∞–≤—å—Ç–µ 3 —Å–µ–∫—Ä–µ—Ç–∞:

#### `SSH_HOST`
```
–ó–Ω–∞—á–µ–Ω–∏–µ: 91.229.8.221
```

#### `SSH_USERNAME`
```
–ó–Ω–∞—á–µ–Ω–∏–µ: root
```

#### `SSH_PRIVATE_KEY`
```
–ó–Ω–∞—á–µ–Ω–∏–µ: -----BEGIN OPENSSH PRIVATE KEY-----
(–≤–µ—Å—å –≤–∞—à –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á)
-----END OPENSSH PRIVATE KEY-----
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –°–¥–µ–ª–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–º–º–∏—Ç
git commit --allow-empty -m "test: Check auto-deploy"
git push origin main
```

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞: https://github.com/nikita-tita/cian-analyzer/actions

–í—ã —É–≤–∏–¥–∏—Ç–µ:
- ‚úÖ Test job - –ø—Ä–æ–≥–Ω–∞–ª —Ç–µ—Å—Ç—ã
- ‚úÖ Build job - —Å–æ–±—Ä–∞–ª Docker
- ‚úÖ Deploy job - –∑–∞–¥–µ–ø–ª–æ–∏–ª –Ω–∞ housler.ru
- ‚úÖ Notify job - –æ—Ç–ø—Ä–∞–≤–∏–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

---

## üéØ –ß—Ç–æ –¥–µ–ø–ª–æ–∏—Ç—Å—è

–ü—Ä–∏ push –≤ `main` –¥–µ–ø–ª–æ—è—Ç—Å—è –í–°–ï —Ñ–∞–π–ª—ã –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:

```
‚úÖ app_new.py (–æ—Å–Ω–æ–≤–Ω–æ–π Flask app)
‚úÖ src/ (–≤–µ—Å—å –∫–æ–¥)
‚úÖ static/ (CSS, JS)
‚úÖ templates/ (HTML —à–∞–±–ª–æ–Ω—ã)
‚úÖ requirements.txt (–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
‚úÖ .env (—Å–µ–∫—Ä–µ—Ç—ã - —á–µ—Ä–µ–∑ secure deployment)
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
cd /var/www/housler
git pull origin main                 # –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤—ã–π –∫–æ–¥
bash scripts/auto-deploy.sh production true
  ‚îú‚îÄ Backup —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏
  ‚îú‚îÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
  ‚îú‚îÄ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π (–µ—Å–ª–∏ –µ—Å—Ç—å)
  ‚îú‚îÄ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ systemd service
  ‚îî‚îÄ Health check
```

### –°–µ–∫—Ä–µ—Ç—ã –ù–ï –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
- `.env` - –≤ `.gitignore`
- `SSH_PRIVATE_KEY` - —Ç–æ–ª—å–∫–æ –≤ GitHub Secrets
- `REDIS_PASSWORD` - —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–µ–ø–ª–æ—è

### GitHub Actions Dashboard:
https://github.com/nikita-tita/cian-analyzer/actions

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
ssh root@91.229.8.221 "systemctl status housler"
ssh root@91.229.8.221 "journalctl -u housler -n 100"
```

### Health check:
```bash
curl https://housler.ru/health
```

---

## üêõ Troubleshooting

### –î–µ–ø–ª–æ–π failed –Ω–∞ —à–∞–≥–µ Test
**–ü—Ä–∏—á–∏–Ω–∞**: –¢–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—à–ª–∏
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ, –∑–∞—Ç–µ–º push

### –î–µ–ø–ª–æ–π failed –Ω–∞ —à–∞–≥–µ Build
**–ü—Ä–∏—á–∏–Ω–∞**: Docker image –Ω–µ —Å–æ–±—Ä–∞–ª—Å—è
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Dockerfile

### –î–µ–ø–ª–æ–π failed –Ω–∞ —à–∞–≥–µ Deploy
**–ü—Ä–∏—á–∏–Ω–∞**: SSH –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –≤—Ä—É—á–Ω—É—é
ssh root@91.229.8.221

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω
ssh-add -l

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ GitHub Actions
```

### –î–µ–ø–ª–æ–π —É—Å–ø–µ—à–µ–Ω, –Ω–æ —Å–∞–π—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@91.229.8.221

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
systemctl status housler

# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏
journalctl -u housler -n 100 -f

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Ä—É—á–Ω—É—é
systemctl restart housler
```

---

## üö¶ Rollback (–æ—Ç–∫–∞—Ç –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é)

–ï—Å–ª–∏ –Ω–æ–≤—ã–π –¥–µ–ø–ª–æ–π —Å–ª–æ–º–∞–ª —Å–∞–π—Ç:

```bash
ssh root@91.229.8.221

cd /var/www/housler

# –ù–∞–π–¥–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π backup
ls -la /var/www/housler_backup_*

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ backup
git reset --hard HASH_–ü–†–ï–î–´–î–£–©–ï–ì–û_–ö–û–ú–ú–ò–¢–ê
systemctl restart housler

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ backup
rm -rf /var/www/housler_old
mv /var/www/housler /var/www/housler_broken
mv /var/www/housler_backup_–î–ê–¢–ê /var/www/housler
systemctl restart housler
```

---

## ‚úÖ Checklist –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- [ ] SSH –∫–ª—é—á —Å–æ–∑–¥–∞–Ω/–ø–æ–ª—É—á–µ–Ω
- [ ] –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- [ ] –°–µ–∫—Ä–µ—Ç—ã `SSH_HOST`, `SSH_USERNAME`, `SSH_PRIVATE_KEY` –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ GitHub
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π push —Å–¥–µ–ª–∞–Ω
- [ ] GitHub Actions –ø—Ä–æ–≥–Ω–∞–ª workflow
- [ ] –î–µ–ø–ª–æ–π –Ω–∞ housler.ru –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ
- [ ] –°–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

---

## üéâ –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º `git push origin main`:

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–µ—Å—Ç—ã**
2. **–°–æ–±–∏—Ä–∞–µ—Ç—Å—è Docker image**
3. **–î–µ–ø–ª–æ–∏—Ç—Å—è –Ω–∞ housler.ru**
4. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è health check**
5. **–í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ**

**–ù–∏–∫–∞–∫–∏—Ö —Ä—É—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è!** üöÄ

---

## üìñ –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–µ–ø–ª–æ—è
gh run list --workflow=auto-deploy.yml --limit 1

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π –≤—Ä—É—á–Ω—É—é (–±–µ–∑ push)
gh workflow run auto-deploy.yml

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–µ–ø–ª–æ—è
gh run view --log

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–∞ production
ssh root@91.229.8.221 "cd /var/www/housler && git log -1 --oneline"
```

---

Created: 2025-11-15
Author: Claude Code
Status: Ready for production ‚úÖ
